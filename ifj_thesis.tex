% This is the Reed College LaTeX thesis template. Most of the work 
% for the document class was done by Sam Noble (SN), as well as this
% template. Later comments etc. by Ben Salzberg (BTS). Additional
% restructuring and APA support by Jess Youngberg (JY).
% Your comments and suggestions are more than welcome; please email
% them to cus@reed.edu
%
% See http://web.reed.edu/cis/help/latex.html for help. There are a 
% great bunch of help pages there, with notes on
% getting started, bibtex, etc. Go there and read it if you're not
% already familiar with LaTeX.
%
% Any line that starts with a percent symbol is a comment. 
% They won't show up in the document, and are useful for notes 
% to yourself and explaining commands. 
% Commenting also removes a line from the document; 
% very handy for troubleshooting problems. -BTS

% As far as I know, this follows the requirements laid out in 
% the 2002-2003 Senior Handbook. Ask a librarian to check the 
% document before binding. -SN

%%
%% Preamble
%%
% \documentclass{<something>} must begin each LaTeX document
\documentclass[12pt,twoside]{reedthesis}
% Packages are extensions to the basic LaTeX functions. Whatever you
% want to typeset, there is probably a package out there for it.
% Chemistry (chemtex), screenplays, you name it.
% Check out CTAN to see: http://www.ctan.org/
%%
\usepackage{graphicx, latexsym} 
\usepackage{amssymb,amsthm,amsmath,algorithm}
\usepackage{longtable,booktabs,setspace} 
\usepackage[hyphens]{url}
\usepackage{rotating}
\usepackage{natbib}
\usepackage[noabbrev]{cleveref}
% \crefname{fig}{figure}{lemmas}
\usepackage{paralist}
\usepackage{algpseudocode}
\usepackage{pstricks}
% \usepackage[T1]{fontenc}
% \usepackage{epstopdf}
\usepackage{dirtytalk}
\usepackage{subcaption}
\usepackage{nameref}
\usepackage{wrapfig}
\usepackage{dsfont}
\captionsetup{format=hang,justification=raggedright}
% \usepackage{minipage}
\graphicspath{ {figs/} }
\makeatletter
\let\OldStatex\Statex
\renewcommand{\Statex}[1][3]{%
  \setlength\@tempdima{\algorithmicindent}%
  \OldStatex\hskip\dimexpr#1\@tempdima\relax}
\makeatother
% Comment out the natbib line above and uncomment the following two lines to use the new 
% biblatex-chicago style, for Chicago A. Also make some changes at the end where the 
% bibliography is included. 
%\usepackage{biblatex-chicago}
%\bibliography{thesis}

% \usepackage{times} % other fonts are available like times, bookman, charter, palatino

\title{the big paper, if you will}
\author{Isabella F. Jorissen}
% The month and year that you submit your FINAL draft TO THE LIBRARY (May or December)
\date{May 2016}
\division{Mathematics and Natural Sciences}
\advisor{James Fix}
%If you have two advisors for some reason, you can use the following
%\altadvisor{Your Other Advisor}
%%% Remember to use the correct department!
\department{Mathematics}
% if you're writing a thesis in an interdisciplinary major,
% uncomment the line below and change the text as appropriate.
% check the Senior Handbook if unsure.
%\thedivisionof{The Established Interdisciplinary Committee for}
% if you want the approval page to say "Approved for the Committee",
% uncomment the next line
%\approvedforthe{Committee}
% \newtheorem{def}{Definition}
\setlength{\parskip}{0pt}
%%
%% End Preamble
%%
%% The fun begins:
\begin{document}

  \maketitle
  \frontmatter % this stuff will be roman-numbered
  \pagestyle{empty} % this removes page numbers from the frontmatter

% Acknowledgements (Acceptable American spelling) are optional
% So are Acknowledgments (proper English spelling)
    \chapter*{Acknowledgements}
	I want to thank a few (lots, really) people.

% The preface is optional
% To remove it, comment it out or delete it.
    \chapter*{Preface}
    [I'm going to tell you a story about a math problem. There will be some words (don't worry about their meaning too much), some concepts (the words will help some), and a few pretty diagrams (to pull it all together). This is a story about a lot of things, depending on your perspective. In a way, it's a story about figuring out where you ought to go based on where you are. At least, that one of the ways I like to think about it. I've thrown in a little High Performance Computing for good measure, since - if you're anything like me - you'll want to know where your destination is as quickly as possible.

    This math problem has a lot of names, and has been discovered, re-discovered, named, re-named, used, and re-used in more disciplines than I'm willing to count or list. I'd argue that the ``conceptual'' ``mathematical'' structure itself ``belongs'' to the realm of Computational Geometry, where it's referred to as the Voronoi Diagram. It has many aliases: Dirichlet Tesselation, Thiessen Polygons, Plant Polygons, and Wigner-Seitz Cell, among others. 

    In the names of Tradition and Clarity, I've done my best to use exoteric language whenever possible, and to indulge in mathematical notation where appropriate. You're welcome to treat either as an endless stream of notation. My only advice to you, in the words of a Reed math professor I once had: ``remain calm.'']


	% This is an example of a thesis setup to use the reed thesis document class.

    \tableofcontents
    \listofalgorithms
    \listoffigures

% The abstract is not required if you're writing a creative thesis (but aren't they all?)
% If your abstract is longer than a page, there may be a formatting issue.
    \chapter*{Abstract}
    [more specifics][math specifics]
	
	% \chapter*{Dedication}
	% You can have a dedication here if you wish.

  \mainmatter % here the regular arabic numbering starts
  \pagestyle{fancyplain} % turns page numbering back on

%The \introduction command is provided as a convenience.
%if you want special chapter formatting, you'll probably want to avoid using it altogether
% \onehalfspacing
  \chapter*{The Voronoi Diagram}
    \addcontentsline{toc}{chapter}{The Voronoi Diagram}
    \setcounter{chapter}{1}
    \setcounter{section}{0}
  \chaptermark{The Voronoi Diagram}

  \say{... To make this long discourse less boring for you, I want to wrap up part of it in the guise of a fable, in the course of which I hope the truth will not fail to manifest itself sufficiently clearly, and that this will be no less pleasing to you than if I were to set it forth wholly naked,}\citep[][p. 21]{descartes}.

  \section{Descartes' Cosmological Picture} % (fold)
  \label{sec:the_world}
    Ren\'{e} Descartes spent four years writing \emph{The World}, and abandoned it in 1633 after the Roman Inquisition condemned Galileo and his heliocentric theory. It remained largely unpublished for thirty-one years after its abandonment, save for some fragments which appeared in \emph{Principia philosophiae}. \emph{Treatise on Light}, first published as \emph{The World}, was not published until fifteen years after Descartes' death, on a leap year almost four hundred years ago. \par

    Stepping into the world which Descartes presents in \emph{Treatise on Light} is astonishing in its own right, as his theory culminates in a cosmology where heavenly bodies lie unperturbed at the centers of endlessly swirling corpuscles. For our purposes, the salient portion of Descartes' theory lies in this cosmology; his illustrations of the movement of bodies within the heavens are often touted as the first, however informal, use of the Voronoi diagram. \par

    Under Descartes' view-- which builds off of his contemporaries-- there exists a trinity of elements. He writes \say{the Philosophers maintain that above the clouds there is a kind of air much subtler than ours, \ldots They say too that above this air there is yet another body, more subtle still, which they call the element of fire,}\citep[p. 17]{descartes}. The third and final element is the element of earth, and it is the least \say{fine} of the three elements. These three elements may combine to create mixed or composite elements. The form of the first element is terribly small, and moves incredibly quickly-- the status, position, or size at any given time is imperceptible and indeterminate. The form of the third element, however, a large and move with much less urgency, and may resist the forces of other bodies. Further, Descartes believes that the elements of a higher order, that is to say, of a subtler sort, fill the gaps between the elements of a lower order so that they might constitute a perfectly solid body. \say{I say that this subtler air and this element of fire fill the gaps between the parts of the gross air that we breathe, so that these bodies, interlaced with one another, make up a mass as solid as any body can be,} \citep[][p. 17]{descartes}. \par 

    In the section \emph{How, in the world as described, the heavens, the sun and the stars are formed}, Descartes asks us to imagine a new world in which we might have a number of bodies made up of the same matter. For Descartes, any given body of matter is surrounded on all sides by other bodies, arranged in such a way that there is no void between any two of them \citep[p. 25]{descartes}. God agitates each body, giving it direction and motion; under this model, bodies are colliding constantly. The effects of a collision might be the breaking up or change in direction of one or more bodies. The smallest fragments, the products of many collisions, take the form of the finest first element which Descartes describes. The largest bodies do not break apart. Rather, they join together and form the third element. \par

    The inclination of these \say{agitated} bodies is to move in a straight line, but the bodies all have a variety of masses and levels of agitation associated with them, so there emerges a rough ordering of the bodies about the center. Broadly, the smallest and least agitated bodies turn about the area closest to the center, while the larger or more agitated bodies trace out the larger circles around the center; at first blush, their movement might even resemble a straight line. Descartes superimposes this trinity of elements onto the principal parts of the universe: \say{the Sun and the fixed stars as the first kind, the heavens as the second, and the Earth with the planets and comets as the third,}\citep[][p. 20]{descartes}. Then, the center around which the bodies turn is a star, composed entirely of the first element; the elements which turn around it are the heavens; and the other earthly bodies are composed entirely of the third element.\par

   % Furthermore, he notes that it is impossible for bodies to move in a straight line, in fact, each must travel along curved path of motion. \par

    \begin{wrapfigure}{r}{0.54\textwidth}
      \centering
      \includegraphics[width=.4\textwidth]{descartes_transparent_heavenly}
      \caption{Descartes' Heavenly Regions}
      \label{fig:descartes_heavenly}
    \end{wrapfigure}
   % ABOVE ^^^ IS THIS NOT A CONTRADICTION? Above descartes says that the higher order elements penetrate the lwoer order ones

   % The center, description of which we have delicately and deliberately escaped, is a star: a heavenly body composed entirely of the first element. The bodies which are composed of the second element and which turn about a center are called the heavens \citep[][p. 35]{descartes}. \par

   Descartes' depicted his cosmological understanding with a diagram, one most directly likened to a Voronoi diagram through his description of the heavens as a whole. Shown in \cref{fig:descartes_heavenly}, there is a heaven (we might call it a heavenly region) for each star. He writes: \say{So there are as many different heavens as there are stars, and since the number of stars is indefinite so too is the number of heavens. And the firmament is just a surface without thickness separating all the heavens from one another,}\citep[p. 35]{descartes}.\par

   With Descartes' cosmology in the back of our minds, we look to \cref{fig:descartes_heavenly}. What Descartes has drawn around each star are (roughly) concentric circles representing the matter turning about the star. Examining the region near $S$ more closely, we can see that the largest circles intersect with the circles emanating out of the other stars. In Descartes' terms, when circles surrounding a given star intersect with another set of circles, they do so at the \emph{firmament}, which separates the heavenly regions from another. Visually, the firmament between any two heavenly regions--- take, for example, $S$ and $\epsilon$ --- occurs along the set of points equidistant from both $S$ and $\epsilon$. The \say{corners} of the firmament, as Descartes calls them, are points where three circles--- each originating from a distinct heavenly body--- intersect. [What was the sentence that Jim said would be good?]\par
   % For those who are already familiar with the Voronoi diagram, it is easy to recognize the visual similarities between Descartes' graphical representation of the heavens and the Voronoi diagram. Perhaps more interesting, however, are the similarities between what he understands the diagram to be and the definition of a Voronoi diagram. As we mentioned earlier, Descartes believes that every star has a heaven associated with it. For example, the matter in the region defined as \textsc{hggh} is the heaven which rotates around $\epsilon$. Similarly, the heaven of star $S$ is precisely the matter in the region \textsc{fggf}. When we define the Voronoi diagram of a set of sites, we will note that every site has a corresponding region. The \emph{firmament}, as Descartes calls it, can be readily adapted to the Voronoi diagram with a shift in jargon: the firmament which separates the heavens from each other are referred to as \emph{edges} in the Voronoi diagram. Should we have the desire to squint, we might even be able to glimpse an oblique reference to a Voronoi vertex: Descartes writes of the matter which lives at the intersection of three or more circles, at what appear to be \say{corners} of the firmament, it is likely smaller, and less agitated than the matter surrounding it.  

  % section the_world (end)

  \section{Definition of the Voronoi Diagram in $\mathds{R}^d$} % (fold)
  \label{sec:definition_of_the_voronoi_diagram_in_rd}
    Rather than dwelling on Descartes' understanding of the cosmos, we focus on the mathematical diagram that his picture evokes. To that end, let $P:=\{p_{1}, p_{2},\ldots, p_{n}\}$ be a finite set of $n$ distinct points in $\mathds{R}^d$. The Voronoi diagram of $P$, $\mbox{Vor}(P)$, is a division of $\mathds{R}^d$ into $n$ regions. Specifically, $$\mbox{Vor}(P):=\{V_{1}, V_{2}, \ldots, V_{n}\}$$ where each region $V_{i}$ is defined by 
    $$V_{i} := \{\,q \in \mathds{R}^d \mid \delta(q, p_{i}) \leq \delta(q, p_{j}) \text{ for all }\, p_{j}\in P\,\text{ where }j\neq i \}.$$ We take the $\delta(q, p)$ to be $\lVert p-q \rVert$, the usual measure of distance in $\mathds{R}^d$. 
     \Cref{fig:first_sight} shows a Voronoi diagram of nine sites in the plane $\mathds{R}^2$.\par

    \begin{figure}[!htb]
      \centering
      \input{figs/intro/first_sight.tex}
      \caption{A Voronoi Diagram on nine sites}
      \label{fig:first_sight}
    \end{figure} 

    The Voronoi diagram in $\mathds{R}^2$ consists of Voronoi vertices, Voronoi regions, and Voronoi edges. For the purposes of this thesis, we will be working with diagrams in $\mathds{R}^2$. We compute the diagram on a set of sites, $P$, which are points in $\mathds{R}^2$. A Voronoi region, or cell, is bounded by Voronoi edges; every point contained within the region is closer to the site associated with that region than it is to any other site. Voronoi edges, represented by solid lines in \cref{fig:first_sight}, are the set of points which are equidistant from the sites on either side of the edge. These edges intersect at Voronoi vertices; every vertex is equidistant to three sites.\par 

    The Voronoi diagram is a tiling of the plane. It is also referred to as the Voronoi tessellation, and occasionally as the Voronoi graph.  [finish or cut]
  % section definition_of_the_voronoi_diagram_in_re_d_ (end)
  
  \section{A Half-Plane Characterization} % (fold)
  \label{sec:half_plane_char}
    Every Voronoi region can be thought of as a (possibly unbounded) convex polygon whose edges are the bounding lines of the convex regions and whose vertices are the points of intersection between the bounding lines.  Let's unpack that a little bit. Given two sites $p_{i}$ and $p_{j}$, imagine the line, $\ell$ connecting them. Let $b$ be the perpendicular bisector of $\ell$, which splits the plane into two half-planes. Define the half-plane along $b$ containing $p_{i}$ with $h(p_{i}, p_{j})$; similarly, define the half-plane containing $p_{j}$ with $h(p_{j}, p_{i})$. We can connect this notion of half-planes to our original definition of a Voronoi region: note that with the exception of the set of points lying on $b$, all of the points in $h(p_{i}, p_{j})$ will \emph{not} be in $p_{j}$'s region, since every point in $h(p_{i}, p_{j})$ is closer to $p_{i}$ than it is to $p_{j}$. The points lying along $b$ will be included in both regions, since they are equidistant from $p_{i}$ and $p_{j}$. The dashed line in \cref{fig:one_half_plane} is the perpendicular bisector of $p$ and $q$. The shaded region represents the half-plane $h(p, q)$.\par

    Define set of half-planes containing $p_{i}$ as $H_{i} := \{\,h(p_{i}, p_{j}) \mid j\neq i \}$. There are $n-1$ half-planes in $H_{i}$. Consider the intersection of any two of these half-planes, $h(p_{i}, p_{j})$ and $h(p_{i}, p_{k})$. The set of points lying in the intersection of $h(p_{i}, p_{j})$ and $h(p_{i}, p_{k})$ are all of the points which are at least as close or closer to $p_{i}$ as they are to $p_{j}$ or $p_{k}$. Extrapolating a bit further, if we performed this intersection over all $n-1$ half-planes, we would have the necessary information to determine the set of points which are at least as close or closer to $p_{i}$ as they are to all other sites. Which is, of course, the description of the $V_{i}$ exactly. So we can also describe the region as the intersection of a set of half-planes:
    $$V_{i} = \bigcap_{h \in H_{i}}$$ 

    \Cref{fig:all_half_planes} illustrates how $V_{p}$ is formed by the intersection of half-planes, it is the darkest shaded region bounded by a solid border.

    \begin{figure}[!htb]
      \centering
      \begin{subtable}{.475\textwidth}
        \input{figs/intro/half_plane0.tex}
        \caption{One half-plane, $h(p, q)$}
        \label{fig:one_half_plane}
      \end{subtable}%
      \begin{subtable}{.475\textwidth}
      \centering
        \input{figs/intro/half_plane.tex}
        \caption{$V_{p}$ from half-plane intersections}
        \label{fig:all_half_planes}
      \end{subtable}
      \caption{Half-Plane Intersections}
      \label{fig:half_planes}
    \end{figure}
    Recall that a set is convex if the line segment connecting any two points in the set is also in the region. Because the half-plane is a convex set and the intersection of convex regions is also convex, the Voronoi region is convex. In \cref{sec:a_naive_approach} we describe an algorithm to construct the Voronoi diagram using an approach which relies on half-plane intersections.\par

    % In summary, every Voronoi region can be thought of as a (possibly unbounded) convex polygon whose edges are the bounding lines of the convex regions and whose vertices are the points of intersection between the bounding lines. 

    Note that some of the edges will be line segments, while others will extend out towards infinity. We will refer to the latter type of edge as a \emph{half infinite edge}. Since the region was the result of $n-1$ half-plane intersections, we know that the region has, at most, $n-1$ edges. \par
  % section  (end)

  \section{The Voronoi Graph} % (fold)
  \label{sec:voronoi_graph}
    Note that the various components of a Voronoi diagram--- its edges, vertices, and regions--- relate to each other in a non-geometric way. Namely, there is an underlying combinatorial structure associated with a diagram. Consider the set of edges of a Voronoi diagram. An edge connects two Voronoi vertices. We can leverage this fact to describe the Voronoi diagram in a combinatorial way: as a graph.\par

    Recall that a graph is a collection of vertices and edges. Given $\mbox{Vor}(P)$, let $C$ be the set of Voronoi vertices and let $E$ be the set of Voronoi edges. Every Voronoi edge $e$ in $E$ is a pair $(c_{i}, c_{j})$ for two distinct $c_{i}, c_{j}$  in $C$. Through describing $\mbox{Vor}(P)$ in this way, we recognize it as a graph whose embedding in $\mathds{R}^2$ satisfies the geometric characteristics of the Voronoi diagram.\par

    Our attempts to consider $\mbox{Vor}(P)$ as a graph will be thwarted if we don't address the edges which do not necessarily connect two Voronoi vertices. These are the \emph{half-infinite edges}, discussed in \cref{sec:half_plane_char}. To account for this, we can introduce a vertex \say{at infinity}. Then, we assign the vertex at infinity to be second endpoint of each half infinite edge in the diagram.\Cref{fig:vertex_at_infinity} illustrates how the addition of a vertex at infinity changes the Voronoi diagram of nine sites we saw in \cref{fig:first_sight}.\par

    \begin{figure}[!htb]
      \centering
      \input{figs/intro/vertex_at_infinity.tex}
      \caption{Connecting Half-Infinite Edges to $v_{\infty}$}
      \label{fig:vertex_at_infinity}
    \end{figure}

    We can leverage the properties of a planar\footnote{Recall that when a graph is planar, it can be embedded in the plane in a way that no edges in the graph intersect unless they have the same endpoints. This is clearly the case for a Voronoi diagram embedded in $\mathds{R}^2$}, graph further. Specifically, we can apply \emph{Euler's Formula} to show upper bounds on the number of vertices, edges, and faces in $\mbox{Vor}(P)$. 

    \emph{Euler's Formula} states that any planar graph with $v$ vertices, $e$ edges, and $f$ faces (regions, for our purposes) the following is true: $v - e + f = 2.$ Furthermore, if the graph is \emph{simple,}\footnote{A simple graph is one which does not contain multiple edges with the same endpoints or edges whose two endpoints are the same, often called a \say{loop}.} that $e \leq 3n -6$.\par

    We apply Euler's Formula to slightly modified $\mbox{Vor}(P)$. Let $n = |V|$, the number of Voronoi regions; $k = |C|$, the number of vertices not including the vertex at infinity, and $m = |E|$, the number of edges.
    $$(k + 1) - m + n = 2.$$ 
    Since every edge has exactly two endpoints and every vertex is of degree three,\footnote{This doesn't include the vertex at infinity, which will have out-degree \emph{at least} three.} we can say that $2m \geq 3(k + 1)$. Together with Euler's formula, this implies that when $n\geq 3$, the number of vertices is at most $2n-5$ and the number of edges is at most $3n-6$. Through recognizing that the number of regions is equal to the number of sites and that the upper bounds on $k$ and $m$ correspond linearly with $n$, we can say that the Voronoi diagram has linear complexity. 

    % We know that $\mbox{Vor}(P)$ will have $n$ regions; and we can put an upper bound on the number of edges and vertices it has by recognizing that a Voronoi diagram in $\mathds{R}^2$ is \emph{nearly} a planar graph. We make the Voronoi diagram of $P$ into a planar graph by introducing a vertex ``at infinity''. Then, we assign the vertex at infinity to be the source (or destination, when appropriate) to the half infinite edges (that is to say, all edges without two endpoints).\par

    % Note that the size of the Voronoi graph is linear in the number of sites. \emph{Euler's Formula} states that any planar graph with $v$ vertices, $e$ edges, and $f$ faces (regions, for our purposes) the following is true:
    % $v - e + f = 2.$ 

  \section{The Voronoi Diagram and its Dual} % (fold)
  \label{sec:the_voronoi_diagram_and_its_dual}
    While the Voronoi diagram can be computed directly with relative--- though certainly not always computational--- ease, it can also be computed somewhat indirectly, that is, through the construction of its dual, the \emph{Delaunay subdivision}. If we assume that the set of sites $P$ is \say{well-behaved,}\footnote{We'll wave our hands at this for now, and in \cref{sec:the_fine_print} we'll define more precisely what it means for the set of sites to be \say{well-behaved.}} then the resulting diagram is the Delaunay triangulation of those sites, $\mbox{Del}(P)$. Furthermore, the Delaunay triangulation of a Voronoi diagram is unique. One of the many advantages of working with the dual is the ability to work with triangular faces instead of with polygonal regions with an unknown number of sides. \par

    We can develop our intuition for the Delaunay triangulation and the primal-dual relationship by constructing $\mbox{Del}(P)$ from $\mbox{Vor}(P)$. Choose a site $p_{i} \in P$. Using $\mbox{Vor}(P)$ as a reference, draw a line connecting $p_{i}$ to the sites of the regions adjacent to it, as in \cref{fig:del_intuition1}. Do this for all the sites. The resulting diagram is the unique Delaunay Triangulation of $P$, as shown in \cref{fig:del_intuition2}.

    \begin{figure}[!htb]
      \centering
      \begin{subtable}{.475\textwidth}
        \input{figs/intro/del_intuition_1.tex}
        \caption{A site connected to its adjacent sites}
        \label{fig:del_intuition1}
      \end{subtable}%
      \begin{subtable}{.475\textwidth}
        \input{figs/intro/del_intuition_done.tex}
        \caption{All sites connected to neighboring sites}
        \label{fig:del_intuition2}
      \end{subtable}
      \caption{Voronoi Diagram (Solid) and Delaunay Triangulation (Dashed)}
      \label{fig:del_intuition}
    \end{figure}

    % move degenerate case to a last paragraph where you can finally be honest with them
    % Note that we are being a bit cavalier with this description of the Delaunay triangulation. If four or more sites were co-circular, our result would be a Delaunay subdivision, which could be quickly modified (via the addition of edges, if necessary) to be a Delaunay triangulation. Furthermore, the Delaunay triangulation of a  Voronoi diagram whose sites are in general position is unique.\par

    Let's take a couple steps back and define the Delaunay triangulation a bit more rigorously, so we can better examine its properties and relation to the Voronoi diagram. It's useful, for our purposes, to consider the \emph{convex hull}. The convex hull of a set of points $P$ is the smallest convex region containing $P$. Roughly, it is the intersection of all of the convex sets containing $P$. Precisely: given points $q_{1}$,... $q_{k}$, a \emph{convex combination} of those points is defined as $\Sigma\alpha_{i}q_{i}$, where the $\alpha_{i}$'s are non-negative and $\Sigma\alpha_{i}=1.$  So, for our point set $P$, we are interested in the convex hull, denoted $\mbox{conv}(P)$, defined as the set:

     % in $\mathds{R}^2$, define $q$ to be a special type of affine combination called a \emph{convex combination}, 

    % Precisely, given $n$ points in $\mathds{R}^2$, define $q$ to be a special type of affine combination called a \emph{convex combination}, and the points generated by the combination of $p_{i}$'s are the \emph{convex set}.\cite{SHAMOS pg 90-91}
    \[
     \mbox{conv}(P) = \{\, \alpha_{1}p_{1} + ... + \alpha_{n}p_{n} \ \mid\ \text{for$ \,\alpha_{i} \in \Re, \; \alpha_{i} \geq 0$ and $\Sigma\alpha_{i} = 1$}\,\} 
    \]
    \Cref{fig:convex_hull} illustrates the convex hull of the same point set used in \cref{fig:del_intuition1,fig:del_intuition2}. 
    This region of the plane is best understood in terms of a complete description of its boundary, as shown in \cref{fig:convex_hull}.\par

    \begin{figure}[!htb]
      \centering
      \input{figs/intro/convex_hull.tex}
      \caption{Convex hull of a set of points}
      \label{fig:convex_hull}
    \end{figure}

    A triangulation is a subdivision of the plane into triangular faces. More specifically, the triangulation of a point-set is a set of non-overlapping triangles where the union of the regions bounded by the triangles is the convex hull of $P$. The vertices of the triangles are taken from the point set, and each point in the set must be the vertex of at least one triangle. The boundary of the Delaunay triangulation of P is the convex hull of $P$. It's important to note here that every edge in the convex hull of a set of sites is an edge in the Delaunay triangulation.\par

    We can confirm the Delaunayhood of a triangulation in two ways. For two sites $a, b \in P$, we say that that the edge connecting them satisfies the Delaunay property if the circle passing through $a$ and $b$ does not contain any of the other sites in $P$. An equivalent, and perhaps more common, understanding of the Delaunay property operates on the faces (triangles) of the triangulation instead of its edges. It is often referred to as the \emph{empty circle condition}. The \emph{empty circle condition} stipulates that for a triangle defined by three sites $a, b, c \in P$, the circumcircle of that triangle contains no other sites in $P$. These tests correspond to the geometric properties of the corresponding Voronoi diagram. Asking whether or not a face of the triangulation satisfies the empty circle condition is equivalent to checking whether or not a circle centered at a Voronoi vertex includes no sites and intersects with three sites.\par

    So, given a triangulation, as in \cref{fig:delaunayhood_small}, one way to confirm its Delaunayhood is as follows: for each edge $e$ in the triangulation, we consider the two triangles on either side of the edge.  In the case of \cref{fig:delaunayhood_small}, the triangles which share edge $e$ are $\Delta abd$ and $\Delta bcd$. Because $a$ does not lie in the circumcircle of $\Delta bcd$, shown as a dashed line in \cref{fig:delaunayhood_small}, we say that $e$ is \emph{locally delaunay}. When every edge in the triangulation is locally Delaunay, we may say that the triangulation is \emph{globally Delaunay}.

    \begin{figure}[!htb]
      \centering
      \input{figs/intro/delaunayhood_small.tex}
      \caption{Testing the Delaunayhood of a small triangulation}
      \label{fig:delaunayhood_small}
    \end{figure}

    What distinguishes the Delaunay triangulation of a set $P$ from any other triangulation of $P$ are its unique properties, which are directly related to its privileged position as the dual of the Voronoi diagram. 

    % In \cref{sec:properties_of_voronoi_and_delaunay_diagrams} we will explore some of the convenient and interesting geometric consequences of a triangulation with the Delaunay property.\par

  \section{The Fine Print}
  \label{sec:the_fine_print}
    Here, I'd like to introduce the notion of \emph{general position}, and make note of a special case. Later, when we examine more sophisticated algorithms to compute the Voronoi Diagram and Delaunay Triangulation, we will assume that the set of sites is in general position and that the special case is not the case.
    \subsection{General Position} % (fold)
    \label{sub:general_position}
    
      When the set of sites we'd like to operate on is in \emph{general position}, we can rest assured that we will not be tasked with handling any degenerate cases. These degenerate cases result from the geometric constraints which characterize the Delaunay and Voronoi diagrams. We might also note that since it is the enforcement of these properties which causes these special cases, that the notion of general position is particular to the metric we use.\par

      When constructing Delaunay or Voronoi diagrams in Euclidean space we say that a set of sites, $P$, is in \emph{general position} when the no four sites in $P$ are co-circular.

      Though it isn't a particularly daunting task to understand why four co-circular sites would result in a degenerate case, it's not an exercise I'll leave to you, dear Reader. It is easiest to see the effects of such a scenario play out in the Delaunay triangulation, but I'll also note how it affects the Voronoi diagram. \par

      Four co-circular sites in $P$ results in a degenerate case because the Delaunay triangulation of $P$ will not be unique. In particular, consider the simplest case of this, as illustrated in \cref{fig:co_circular}. Note that when we attempt to triangulate $abcd$, we have a choice between inserting an edge $bd$ and an edge $ac$. Since both of these edges satisfy the Delaunay condition, we have two valid triangulations of $P$. If we didn't try to triangulate $abcd$ at all, then our Delaunay triangulation would, in fact, be a Delaunay subdivision, since one of its facets has four sides. The corresponding effect in the Voronoi diagram would be a Voronoi vertex with out-degree four instead of three. 

      \begin{figure}[!htb]
        \centering
        \input{figs/intro/co_circular.tex}
        \caption{Four Co-circular sites}
        \label{fig:co_circular}
      \end{figure}

      As we will discover in \cref{sec:fortune_s_algorithm}, a Voronoi vertex exists at the center of the circumcircle of the corresponding facet of the Delaunay triangulation. In \cref{fig:co_circular} for example, suppose we inserted edge $ab$. Then we would have two faces, namely $acb$ and $bda$. Since these four sites are co-circular, the circumcircle of the two faces is the same, leading us to insert two Voronoi vertices in the same location (that is to say, the at the center of the circle) Note that we would have had inserted the Voronoi vertex at the same location even if we had inserted edge $bd$. In practice, we will often ignore this degeneracy by allowing two Voronoi vertices in the same location.\par

    % subsection general_position (end)
    \subsection{The Special Case} % (fold)
    \label{sub:special_case}

      When all of the sites in $P$ are collinear, we find ourselves with a special case. Consider one of the simplest scenarios, where $P$ is a set of three collinear sites: $a$, $b$, and $c$, as shown in \cref{fig:collinear}. This time, we'll focus on what the effects would be like in the Voronoi Diagram. The dashed lines in the figure denote the perpendicular bisectors of the line segments connecting adjacent sites. \par  

      \begin{figure}[!htb]
        \centering
        \input{figs/intro/collinear.tex}
        \caption{Voronoi Diagram of Three Collinear Sites}
        \label{fig:collinear}
      \end{figure}

      More generally, note that if all $n$ sites in $P$ are collinear, then there cannot be a triangulation of these sites. Further, the Voronoi Diagram of $P$ is a set of regions whose boundaries are the $n-1$ parallel lines bisecting adjacent sites. 

    % subsection special_cases (end)

  % section the_voronoi_diagram_and_its_dual (end)
  \section{Applications of the Voronoi and Delaunay Diagram} % (fold)
  \label{sec:applications_of_voronoi_and_delaunay_diagrams}
    Beyond the intrinsic allure of the Voronoi diagram and its straight line dual, the Delaunay triangulation, lies a fascinating set of linear time reductions to some of the central proximity problems. This means that if we take the time to pre-process a set of sites into a Voronoi diagram, then we can answer many different questions in linear (or better!) time. This is especially significant when the time complexity of answering that question is greater than $\mathcal{O}(n)$.\par 

    From the previous \cref{sec:the_voronoi_diagram_and_its_dual}, we saw that it is possible to obtain the dual of the Voronoi diagram in linear time. Thus, we can use the Voronoi diagram to solve the problem of triangulating a set of sites $P$, by returning the dual of the diagram. 

    The Post Office Problem is a classic, though perhaps slightly dated, motivation for the Voronoi diagram. However, it captures one of the central use cases for the Voronoi diagram, which is its ability to answer the \emph{nearest neighbor problem}. The nearest neighbor problem can be stated as such: given a set of sites $P$, and a query point $q$, return the point in $P$ which is closest to $q$. Recall that the Voronoi diagram partitions the plane into a set of $\mid\,P\,\mid$ regions which satisfy the stipulation that every point in a given region is closer to the site associated with that region than it is to any other site. Then, given a query point $q$ and a Voronoi diagram of $P$, we can answer the nearest neighbor question by simply locating the region that $q$ is in, a question we can answer in $\mathcal{O}(\log n)$ time with linear auxiliary storage.\citep[p. 214]{shamos}\par
    
    (Closely) related to this are the \emph{closest pair} and \emph{all nearest neighbors} problems. The closest pair problem asks, given a set of sites $P$, which pair of points $p_{i}$ and $p_{j}$ in $P$ are closest? The all nearest neighbors problem can be framed similarly: given a set of sites $P$, return a collection of pairs ($p_{i}$, $p_{j}$) such that $p_{j}$ is the nearest neighbor of $p_{i}$.\footnote{Note here that the closest pair problem is really a specification of the nearest neighbors problem where the query point $q$ is some $p_{i}$ in $P$ and not arbitrary $q$ in $\mathds{R}^2$.} When given a Voronoi diagram on those sites, the all nearest neighbors problem can be answered in linear time by recognizing that the nearest neighbor of a single site must be one of the sites with which it shares an edge. Equivalently, we can consider the Delaunay triangulation on the same set of sites, $\mbox{Del}(P)$. Recall that each vertex on the Delaunay triangulation is a site of $\mbox{Vor}(P)$. Furthermore, note that the line segment connecting a vertex $p_{i}$ of $\mbox{Del}(P)$ to its nearest neighbor is, and must be, one of the edges in $\mbox{Del}(P)$. So, if we spend time on the order of $\mathcal{O}(n)$ computing the result of the all nearest neighbors problem on $\mbox{Vor}(P)$, we will, by definition, have the answer to the closest pair problem for each site in $P$. 

  \chapter*{Constructing the Voronoi Diagram}
    \addcontentsline{toc}{chapter}{Constructing the Voronoi Diagram}
    \chaptermark{Constructing the Voronoi Diagram}
    \markboth{Constructing the Voronoi Diagram}{Constructing the Voronoi Diagram}
    \setcounter{chapter}{2}
    \setcounter{section}{0}
    % In \cref{sec:formalizing_the_post_office_problem} we saw a naive algorithm for computing the Voronoi diagram of a set of $n$ sites. The time complexity of the half-plane intersection algorithm, as we discovered in \cref{sec:a_naive_approach}, is $\mathcal{O}(n^{2}\log n)$. 

    In this chapter, we will first pause to consider a brute-force half-plane intersection algorithm. It is a natural extension of the discussion in \cref{sec:half_plane_char} and runs in $\mathcal{O}(n^3)$ time. However, there are far more optimal approaches to the construction of the Voronoi diagram. They fall into three rough categories: incremental approaches, divide and conquer approaches, and sweep line approaches. The worst case time complexity for each of these is $\mathcal{O}(n^{2})$, $\mathcal{O}(n\log n)$ and $\mathcal{O}(n\log n)$ respectively. In \cref{sec:fortune_s_algorithm}, we will examine a classic algorithm to compute the Voronoi diagram: Steven Fortune's sweep line algorithm.\par

    Before we move on, we might note that we can't do better than $\mathcal{O}(n\log n)$. Curious reader that you are, you might wonder: \say{Why?} And the answer is this: we can show, quite easily, in fact, that the problem of sorting numbers is \emph{reducible} to the problem of computing the Voronoi diagram. This means that given a set of integers, we can use an algorithm to construct of Voronoi diagram as a subroutine to compute the sorted set. Furthermore, it implies that we will never be able to construct the Voronoi diagram faster (in terms of complexity) than we will be able to sort integers. Thus, an immediate consequence of this reduction is a tight bound on the Voronoi diagram: it can be constructed in optimal time $\theta(n\log n)$.\par

  \section{A Na{\"i}ve Approach} % (fold)
  \label{sec:a_naive_approach}
    In \cref{sec:half_plane_char}, we described a Voronoi cell as the intersection of half-planes containing the site associated with that region. In the same section, we saw that the Voronoi region is a convex region, which may or may not be unbounded. Finally, we noted that if $|P| = n$, then no region $V_{i}$ in $\mbox{Vor}(P)$ can have more than $n-1$ edges. \par


    From these observations, we can cobble together an algorithm for constructing $\mbox{Vor}(P)$, though the strategy is a brutal one.For each site $p_{i}$ in $P$, we compute the set of $n-1$ half-planes containing $p_{i}$; we refer to this set as $H_{i}$. Then, we find the point of intersection (if there is one) of every unique pair of half-planes. Since $|H_{i}| = n-1$, note that there are $\frac{(n-1)(n-2)}{2}$ pairs of half planes. \par

    Note that a half-plane is a region bounded by some line $ax + by + c = 0$\footnote{For visual clarification, refer to \cref{fig:one_half_plane} in \cref{sec:half_plane_char}.}. Correspondingly, it can be described with an inequality of the form $ax + by + c \leq 0$. Knowing that the region $V_{i}$ is bounded by the Voronoi edges which are segments of the boundaries of some $H_{i}$, our goal is to determine where the endpoints of those edges are, namely, where they intersect to meet at a Voronoi vertex. 

    For example, given two half-planes $h(p_{i}, p_{j})$ and $h(p_{i}, p_{k})$, we compute the point of intersection, $inter$. In order for $inter$ to be a Voronoi vertex, it must be the case that it satisfies: $inter \leq ax + by + c$ for each of the half-planes in $H_{i}$. That is to say, that $inter$ must lie within (or on the boundary of) the common intersection of all half-planes in $H_{i}$. If $inter$ satisfies this property, then it will be a vertex of the convex region, $V_{i}$, we are describing. \par

    When we have performed this step for each pair of half-planes, we will have a convex set $\textit{intersection}$ consisting of at most $n-1$ points. To describe the region fully, we find the Voronoi edges of this region through computing the convex hull of $\textit{intersection}$. We repeat this process for each site in $P$. \Cref{sub:alg_sketch_brutal} provides a pseudocode implementation of this approach.\par

    \subsection{Algorithm Sketch \& Pseudocode} % (fold)
    \label{sub:alg_sketch_brutal}
      \begin{algorithm}[H]
      \caption{\textsc{VoronoiFromHalfPlanes}}\label{VoronoiHalfPlane}
      \begin{algorithmic}[1]
      \Require Set of sites, $P$, which are in \emph{general position}
      \Procedure{VoronoiFromHalfPlanes}{$P$}\Comment{Construct $\mbox{Vor}(P)$}
      \State $\mbox{Vor}(P)\gets \{\} $\Comment{Initialize empty diagram}
      \For{$p_{i}$ in $P$}
        \State $\textit{half\_planes}\gets$ $H_{i}$  \Comment{Set of half planes containing $p$}
        \State $\textit{intersections}\gets \{\} $ \Comment{Set of half plane intersections}
        % \For {q in $P - site$}
        %   \State $hpq \gets$ \Call{HalfPlaneEqn}{$p$, $q$}
        %   \State \Call{AddToList}{$half_planes$, $hpq$}
        % \EndFor
        \For{each pair of half planes, $(h_{j}, h_{k})$ in $\textit{half\_planes}$}
          \State $inter \gets$ \Call{HalfPlaneIntersection}{$h_{j}$, $h_{k}$}
          \State $\textit{is\_in}\gets$\Call{HalfPlaneSetContains}{$H_{i}$, $inter$} 
          \If{$\textit{is\_in}$}
            \State \Call{AddIntersection}{$\textit{intersections}$, $inter$}
          \EndIf
        \EndFor
        \State $V_{p}\gets$\Call{ConvexHull}{$\textit{intersections}$}
        \State \Call{AddRegion}{$\mbox{Vor}(P)$, $V_{p}$}
      \EndFor
      \State \textbf{return} $\mbox{Vor}(P)$
      \EndProcedure
      \end{algorithmic} 
      \end{algorithm}


  
  % subsection constructing_a_voronoi_region (end)
  % section a_naive_approach (end)

  \section{A Sweep Line Approach} % (fold)
  \label{sec:fortune_s_algorithm}
    In the 1980's Steven Fortune proposed an algorithm with asymptotic running time $\mathcal{O}(n\log n)$ and using $\mathcal{O}(n)$ space. Fortune's algorithm makes use of a \say{sweep line}; this approach conceptually works by imagining a horizontal line, one that starts above the sites and then descends past the sites, ending below them.

    \subsection{The Actors in Our Play} % (fold)
    \label{sub:the_actors_in_our_play}

% subsection the_actors_in_our_play (end)
      \subsubsection{Events} % (fold)
      \label{ssub:events}
        Very generally, the points of interest in any sweep line algorithm denote moments where we must evaluate whether or not we need to do anything else before continuing to scan the plane. Within the context of Fortune's algorithm, encountering a point of interest signifies that we've learned something new about the Voronoi diagram, such as a Voronoi edge or Voronoi vertex. \par

        We call the points of interest \emph{events}, and there are two types of events we concern ourselves with. The first type, the \emph{site event}, is the simplest. When the sweep line encounters a site, we learn that the Voronoi diagram will have one more region, and we'll also discover two of its bounding edges. In \cref{sub:putting_it_all_together}, we will take a closer look at how to handle a site event. The other type of event is called a \emph{circle event}. When the sweep line intersects with the location associated with the circle event, it signals the addition of a new Voronoi vertex. In \cref{sub:putting_it_all_together}, we'll see how those come about and what it means to handle a circle event.\par

        Finally, to store these upcoming events we might keep them in a \emph{priority queue}, which keeps the events sorted by descending y-coordinate (since the sweep line is traveling \say{down} the plane). Note that we know about all of site events in advance, but we may need to add and remove circle events as necessary. A priority queue will allow us to maintain the sorted order and perform these kinds of operations in optimal time. 

        % subsection circle_events (end)

        % To gain an understanding of how each of these pieces fit together, it's easiest to apply it to a set of sites. Let $P:=\{p_{1}, p_{2}, .. p_{n}\}$ be the a set of $n$ distinct points in $\mathds{R}^{2}$. Then, define the sweep line $s$ to be a horizontal line in $\mathds{R}^{2}$. Note that conceptually, $s$ begins at the ``top'' of the plane, but in practice, it is sufficient that $s$ be initialized with a y-coordinate greater than the site with the largest y-coordinate.\par

        % An astute reader might wonder how exactly we construct the Voronoi diagram with nothing but a set of sites and a vague notion of a line that falls down the plane. After all, there's no obvious method by which the intersection of the sweep line with a point of interest might yield a Voronoi vertex or edge. Further, it would seem that even if we could provide such a relationship would be subject to change as soon as the sweep line encountered the next point of interest. \par
        % Herein lies the elegance of Fortune's algorithm. Consider the portion of the plane that the sweep line has already encountered, this portion constitutes a closed half-plane, $s^+$. If a site exists in $s^+$, then any point $q$ in $s^+$ which is closer to that site than it is to $s$ will not be assigned to a site below $s$. When the sweep line $s$ encounters a site $p_{i}$ we call this a \emph{site event}. We consider the locus of points which are closer to $p_{i}$ than to $s$. The set of points equidistant to $s$ and $p_{i}$ form a parabolic arc. This arc, denoted $\beta_{i}$, is added to a a sequence of parabolic arcs called the \emph{beachfront}. We will refer to the beachfront as $\beta(P)$. The crucial observation is that the points above $\beta(P)$ will be assigned to a site already encountered by $s$. \par

        % To answer this question, let's first make a brief digression and introduce the second structure that Fortune's algorithm employs: the \emph{event queue}. Armed with an understanding of how site events and circle events effect the structure of the beachfront, we can consider ourselves sufficiently motivated to define a structure that keeps track of these kinds of events. We know that the sweep line travels downward, handling site and circle events as it encounters them. In fact, we know a lot about the site events; since we know all the sites before the sweep line begins, we can simply order the sites by decreasing y-coordinate and initialize the event queue with that infomation. Unlike site events, we don't know exactly when or how many circle events will occur\footnote{Though we can provide an upper bound, see \cref{vertex_bounds}}, so they complicate the problem insofar as they punctuate the otherwise predictable order of site events. What we do know is that we'd like to maintain an event queue, which consists of---and is ordered by---all of the site events and the known circle events.  Circle events are added to event queue for every triple of consecutive arcs on the beachfront. So when a site event triggers a new arc on the beachfront, we need to check a couple of things, namely, whether or not the new arc:
        % \begin{itemize}
        % \item invalidates one or more circle events already in the event queue; or
        % \item creates one or more circle events
        % \end{itemize}. Often, handling a site event often has a cascading effect, wherein the event itself doesn't create a circle event, but it might create a situation where one or more circle events would need to added or removed from the event queue. Similarly, handling a circle event can also lead to the creation or removal of one or more circle events, since the disappearance of an arc can lead to new combinations of triples on the beachfront. Note that a circle event exists in the event queue if and only if it satisfies:
        % \begin{itemize}
        % \item the property that the circle defined by the sites corresponding to the triple of arcs intersects the sweep line; and
        % \item hasn't already been deleted from the event queue
        % \end{itemize}.

      % subsection points_of_interest (end)

      \subsubsection{The Beachfront} % (fold)
      \label{ssub:the_beachfront}
        Now, an astute reader might wonder how exactly we construct the Voronoi diagram with nothing but a priority queue and a vague notion of a line that falls down the plane. After all, there's no obvious method by which the intersection of the sweep line with a point of interest might yield a Voronoi vertex or edge. Further, it would seem that even if we could provide such a relationship, it would be subject to change as soon as the sweep line encountered the next point of interest. \par

        Enter the \emph{beachfront}.\footnote{The notion of a beachfront is slightly misleading, as it's not warm and sunny and there are no palm trees swaying in the distance here.} As we'll soon see, the beachfront is a way for us to monitor the \say{in-progress} portion of the Voronoi diagram. The beachfront is a frontier of sorts: every point on or above the beachfront has already been associated with a region, while the points below have not. As the sweep line descends, the parabolic arcs which make up the beachfront shrink and swell. The intersection of adjacent arcs in the sequence trace out Voronoi edges. Arcs are added when site events occur and removed when circle events are handled.\par

        Why parabolas? To answer this question, consider the portion of the plane that the sweep line has already encountered: this portion constitutes a closed half-plane, $s^+$. In \cref{fig:beachfront_se}, $s^+$ is the shaded gray area. If a site exists in $s^+$,---as $p_{j}$ does--- then any point $q$ in $s^+$ which is closer to that site than it is to $s$ will not be assigned to a site below $s$. When the sweep line $s$ encounters $p_{j}$ we handle the site event: we consider the locus of points which are closer to $p_{j}$ than to $s$. The set of points equidistant to $s$ and $p_{j}$ form a parabolic arc. This arc, denoted $\alpha$, in \cref{fig:beachfront_se}, is added to a a sequence of parabolic arcs called the \emph{beachfront}. In \cref{fig:beachfront_se}, $\alpha$ is the first arc in the beachfront. We will refer to the beachfront as $\beta(P)$. \par

        % Reader, a crucial observation is that the points above $\alpha(P)$ will be \say{assigned} to a site already encountered by $s$. \par

        \begin{figure}[!h]        
          \centering
          \input{figs/ch1/fortune/site_event.tex}
          \caption{Adding the first arc, $\alpha$, to the beachfront}
          \label{fig:beachfront_se}
        \end{figure}

        Reader, it is important to make a distinction between the parabola defined by the site's location and the sweep line, and the arc inserted into the beachfront, which is a segment of that parabola. When subsequent site events occur, as in \cref{fig:fortune_1}, the inserted arc $\omega$, intersects with the arc directly above it, effectively splitting into two pieces. At the moment where the new arc, $\omega$, is inserted into the beachfront, it is a simple vertical line (or a parabola with no width). To insert $\omega$ into the beachfront, we split the arc above it, $\alpha$ into two arcs and insert $\omega$ in between the split arcs. We record the points where $\omega$ intersects with the arcs adjacent to it, and we refer to these points as \emph{breakpoints}\footnote{Note that this means that the right breakpoint of $\omega$ is the same as the left breakpoint of the arc which is adjacent on the right. Similarly, the right breakpoint of the arc adjacent to $\omega$ on the left is equal to $\omega$'s left breakpoint.} As $s$ moves downward, the breakpoints of each arc in the beachfront $\beta(P)$ change since the parabola that governs the arc widens. Another way to understand this is to recognize that that parabola whose corresponding arc is $\omega$ has as its focus the site $p_{i}$ and $s$ as its directrix. If we were to draw lines that tracked the movement of the breakpoints for the beachfront as the sweep line descended, they would each trace out the Voronoi edges. \par


        The second way the beachfront's structure changes is when an arc disappears. Circle events trigger the removal of an arc from the beachfront. We'll define the notion of a circle event by studying a small portion of the beachfront. Consider the arcs $\gamma$, $\alpha$, and $\omega$, which are segments of the parabolas defined by three sites $p_{i}$, $p_{j}$, and $p_{k}$, as in \cref{fig:fortune_2,fig:fortune_3}. Define a circle, $C$, with the three sites $p_{i}$, $p_{j}$, $p_{k}$. Though the reasons aren't immediately obvious, we want to keep track of two points: the center of the circle, $q$, and the lowest point of the circle, $\ell$.\par

        If $\alpha$ is the arc that is shrinking, when does it disappear? Recall that the center of the circle, $q$, is equidistant from $p_{i}$, $p_{j}$, $p_{k}$ and $l$. When the sweep line reaches $\ell$, the arcs corresponding to $p_{i}$ and $p_{k}$, $\gamma$ and $\omega$, respectively, intersect at $q$. At this point, the right breakpoint of $\gamma$ and the left breakpoint of $\omega$ become equal to the left and right breakpoints of $\alpha$, and $\alpha$ disappears. So, we handle the circle event $C$ when the sweep line reaches $\ell$. The effect of this on the beachfront is the removal of arc $\alpha$. Outside the context of the beachfront, the circle event signals the introduction of a Voronoi vertex at $q$, the point where the two edges traced out by the intersections of $\gamma$, $\alpha$, and $\omega$ meet.\par

        % To understand how the beachfront plays a role in constructing the Voronoi diagram, let's consider times where the structure of the beachfront changes. New arcs are added to the beachfront whenever a site event occurs. At the moment where the new arc, $\omega$, is inserted into the beachfront, it is a simple vertical line (or a parabola of no width). If there is an arc above $\alpha_{i}$, $\alpha_{i}$ will only intersect it at one point since the beachfront is x-monotone. To insert $\alpha_{i}$ into the beachfront, we split the arc above it into two parabolic arcs and insert $\alpha_{i}$ in between the split arcs. We record the points where $\alpha_{i}$ intersects with the arcs adjacent to it, and we refer to these points as \emph{breakpoints}\footnote{Note that this means that the right breakpoint of $\alpha_{i}$ is the same as the left breakpoint of the arc which is adjacent on the right. Similarly, the right breakpoint of the arc adjacent to $\alpha_{i}$ on the left is equal to $\alpha_{i}$'s left breakpoint.} As $s$ moves downward, the breakpoints of each arc in the beachfront $\alpha(P)$ change since the parabola that governs the arc widens. Another way to understand this is to recognize that that parabola whose corresponding arc is $\alpha_{i}$ has as its focus the site $p_{i}$ and $s$ as its directrix. If we were to draw lines that tracked the movement of the breakpoints for the beachfront as the sweep line descended, they would each trace out the Voronoi edges. So we know that arcs get added to the beachfront whenever a site event occurs, in fact, the \emph{only} time an arc gets added to the beachfront is when a site event occurs. [And we can prove that!] \par

        To summarize, the beachfront is a sequence of parabolic arc segments. The size of the beachfront, that is, the number of arcs composing the beachfront, must be less than or equal to $2n-1$, where $n$ is the number of sites. Each arc is associated with a site, and there may be multiple arcs associated with the same site. As the sweep line moves downward, the equations of the parabolas governing the arcs change, triggering a shift in the breakpoints of those arcs as well. The structure of the beachfront is a function of site events and circle events. A site event occurs when the sweep line intersects with a site (i.e they both have the same y-coordinate) and a circle event occurs when the sweep line intersects with the lowest point (that is to say, the point with the minimum y-coordinate) of a circle. Arcs are added to the beachfront when site events occur, and removed when circle events occur. Looking past the horizon of the beachfront, the effect of an adding an arc is the growth of a new edge, and the effect of removing an arc is the addition of a vertex at the intersection of two edges.\par

      % subsection the_beachfront (end)


    \subsection{Putting It All Together} % (fold)
    \label{sub:putting_it_all_together}
      % To gain an understanding of how each of these pieces fit together, it's easiest to apply it to a set of sites. Let $P:=\{p_{1}, p_{2}, .. p_{n}\}$ be the a set of $n$ distinct points in $\mathds{R}^{2}$. Then, define the sweep line $s$ to be a horizontal line in $\mathds{R}^{2}$. Note that conceptually, $s$ begins at the \say{top} of the plane, but in practice, it is sufficient that $s$ be initialized with a y-coordinate greater than the site with the largest y-coordinate.\par

      Armed with an understanding of how site events and circle events effect the structure of the beachfront, we might consider ourselves sufficiently motivated to understand the particulars of how each of these parts yields information about the Voronoi diagram. We know that the sweep line travels downward, handling site and circle events as it encounters them. In fact, we know a lot about the site events; since we know all the sites before the sweep line begins, we can simply order the sites by decreasing y-coordinate and initialize the event queue with that information. Unlike site events, we don't know exactly when or how many circle events will occur.\footnote{Some circle events will be \emph{false alarms}, a highly technical term we'll be defining soon. Aside from these false alarms, recall that handling a circle event adds a vertex to the finished diagram, and we know from \cref{sec:voronoi_graph} that an upper bound for the number of vertices is $2n-5$ for a Voronoi diagram on $n$ sites.} So, circle events complicate the problem insofar as they punctuate an otherwise predictable order of site events. What we do know is that we'd like to maintain an event queue, which consists of---and is ordered by---all of the site events and the known circle events. \par

      Circle events must be sought out. Recall that a unique circle is defined by three non-collinear points. Circle events trigger the removal of an arc from the beachfront and the addition of a vertex at the center of the circle, which is also the point where the edges traced out by the breakpoints of the removed arc meet. We define a circle event for every triple of consecutive arcs on the beachfront. This means that we need to check for new circle events whenever the sequence of arcs in the beachfront changes.\par

      So when we handle a site event and add it to the beachfront, there are three possibilities:
      \begin{itemize}
      \setlength\itemsep{.5em}
      \item The inserted arc is the first in the beachfront
      \item The inserted arc breaks up the segment above it, as in \cref{fig:site_event_cases0}
      \item The inserted arc intersects the beachfront at the intersection of two arcs, as in \cref{fig:site_event_cases1}
      \end{itemize}
      In the first case, we clearly don't need to add a circle event, since there are no other arcs in the beachfront. In the second case, we need to consider the three new triples of arcs. Note that there is at least one circle event in the queue: $C(p_{i}, p_{j}, p_{k})$, with corresponding arcs $\gamma$, $\alpha$, $\omega$. Let $\chi$ be the inserted arc corresponding to $p_{m}$, so arc $\alpha$ is split into $\alpha'$ and $\alpha''$, as in \cref{fig:site_event_cases0}. The new triples are, from left to right: $\gamma$, $\alpha'$, $\chi$; $\alpha'$, $\chi$, $\alpha''$; and $\chi$, $\alpha''$, $\omega$. Since the second triple has both $\alpha'$ and $\alpha''$ in it, we know that we do not need to add a circle event here. However, we need to add circles for the other two, these circles are: $C(p_{i}, p_{m}, p_{j})$ and $C(p_{m}, p_{j}, p_{k})$. \par

      In the third case, we didn't have to split an arc, but we still need to consider new triples. Namely: $\gamma$, $\alpha$, $\chi$; $\alpha$, $\chi$, $\omega$; and if there is an arc to the right of $\omega$, call it $\psi$:  $\chi$, $\omega$, $\psi$. We add circle events for each of these three triples.\par

      Note that in both of these cases, the arcs associated with $C(p_{i}, p_{j}, p_{k})$, $\gamma$, $\alpha$, $\omega$, are no longer sequential. The edges traced out by the intersections of these arcs will no longer meet at $C(p_{i}, p_{j}, p_{k})$'s center. So we call $C(p_{i}, p_{j}, p_{k})$ a \emph{false alarm}, and we remove it from the event queue.

      \begin{figure}[!htb]
        \centering
        \begin{subtable}{0.475\textwidth}
          \centering
          \input{figs/ch1/fortune/site_event_cases0.tex}
          \caption{Site event at $p_{m}$ splits arc $\alpha$ into $\alpha'$ and $\alpha''$}
          \label{fig:site_event_cases0}
        \end{subtable}
        \begin{subtable}{0.475\textwidth}
          \centering
          \input{figs/ch1/fortune/site_event_cases1.tex}
          \caption{Site event at $p_{m}$ is directly below the intersection of $\alpha$ and $\omega$}
          \label{fig:site_event_cases1}
        \end{subtable}
        \caption{Inserting $\chi$: two ways a site event might affect the beachfront}
        \label{fig:site_event_cases}
      \end{figure}

      %  site event triggers a new arc on the beachfront, we need to check a couple of things, namely, whether or not the new arc:
      % \begin{itemize}
      % \item invalidates one or more circle events already in the event queue; or
      % \item creates one or more circle events
      % \end{itemize} \par

      As long as the sites associated with the arcs are not collinear and are distinct, we will be able to describe a circle with a finite radius. Note that a circle event exists in the event queue if and only if it satisfies:
      \begin{itemize}
      \setlength\itemsep{.5em}
      \item The property that the circle defined by the sites corresponding to the triple of arcs intersects the sweep line
      \item The circle event hasn't already been deleted from the event queue
      \end{itemize}\par
      If the circle event was already deleted from the event queue, we've either already handled it, or it was an \emph{false alarm}. As we've seen, it's often the case that handling a site event has a cascading effect wherein the event itself doesn't create a circle event, but creates a situation where one or more circle events would need to added or removed from the event queue. Similarly, handling a circle event can also lead to the creation or removal of one or more circle events, since the disappearance of an arc can lead to new combinations of triples on the beachfront.\par

      \Cref{fig:construct_vorof_3} illustrates the application of Fortune's algorithm to a small set of three sites: $p_{i}$, $p_{j}$, and $p_{k}$. To understand how to handle a circle event, let's investigate this example. In \cref{fig:fortune_0,fig:fortune_1,fig:fortune_2} we are adding arcs to the beachfront by handling the site events associated with $p_{j}$, $p_{k}$, and $p_{i}$, respectively. In \cref{fig:fortune_2}, we also add a circle event to the event queue, since there are now three consecutive arcs in the beachfront with distinct sites. At this point, the circle event is the only event in the queue left to handle. \Cref{fig:fortune_3} illustrates how the arc $\alpha$ has shrunk as the sweep line has moved downward.  The dotted lines reveal how the breakpoints of $\alpha$ have shifted during this time. When the sweep line intersects with $\ell$, these edges will meet at $q$, and we will add a Voronoi vertex at $q$, as shown in \cref{fig:fortune_done}. At this point the event queue is empty, and the Voronoi diagram of $p_{i}$, $p_{j}$, and $p_{k}$ is three open regions.  However, note that the beachfront is not empty after handling this circle event. In particular, the arcs $\gamma$ and $\omega$ remain. The edge separating $V_{i}$ and $V_{j}$ is a half-infinite edge. Generally, what remains of the beachfront after all of the events have been handled are the remaining half-infinite edges. As a post-processing step of sorts, we will often determine a reasonable bounding box for the diagram, so we can determine the location in $\mathds{R}^2$ of any (half-infinite) edge endpoints going to the vertex at infinity.
   
      \begin{figure}[!htb]
        \centering
        \begin{subtable}{0.475\textwidth}
          \centering
          \input{figs/ch1/fortune/ex1_p0.tex}
          \caption{Handling the first site event}
          \label{fig:fortune_0}
        \end{subtable}%
        \begin{subtable}{0.475\textwidth}
          \centering
          \input{figs/ch1/fortune/ex1_p1.tex}
          \caption{Adding an arc, $\omega$, to the beachfront}
          \label{fig:fortune_1}
        \end{subtable}
        % \caption{(Part 1) Constructing the Voronoi Diagram of three sites}
      \end{figure}
      \begin{figure}[!htb]
      \ContinuedFloat
        \begin{subtable}{0.475\textwidth}
          \centering
          \input{figs/ch1/fortune/ex1_p2.tex}
          \caption{Adding a circle event: circle $C(p_{i}, p_{j}, p_{k})$, with center $q$, and lowest point $\ell$.}
          \label{fig:fortune_2}
        \end{subtable}
        \begin{subtable}{0.475\textwidth}
          \centering
          \input{figs/ch1/fortune/ex1_p3.tex}
          \caption{Approaching the circle event: Arc to be removed, $\alpha$, shown in bold, edges meeting at $q$ are dotted.}
          \label{fig:fortune_3}
        \end{subtable}
        % \caption{(Part 2) Constructing the Voronoi Diagram of three sites}
      \end{figure}

      \begin{figure}[!htb]
      \ContinuedFloat
      \centering
        \begin{subtable}{0.475\textwidth}
          \centering
          \input{figs/ch1/fortune/ex1_done.tex}
          \caption{Handling circle event: finalizing Voronoi edges and adding a vertex}
          \label{fig:fortune_done}
        \end{subtable}
        \caption{Constructing the Voronoi Diagram of three sites}
        \label{fig:construct_vorof_3}
      \end{figure}

      % \Cref{fig:construct_vorof_3} illustrates the application of Fortune's algorithm to a small set of three sites: $p_{i}$, $p_{j}$, and $p_{k}$. To understand how to handle a circle event, let's investigate this example. In \cref{fig:fortune_0,fig:fortune_1,fig:fortune_2} we are adding arcs to the beachfront by handling the site events associated with $p_{j}$, $p_{k}$, and $p_{i}$, respectively. In \cref{fig:fortune_2}, we also add a circle event to the event queue, since there are now three consecutive arcs in the beachfront with distinct sites. At this point, there only 

     % To summarize, the beachfront is a sequence of parabolic arc segments. The size of the beachfront, that is, the number of arcs composing the beachfront, must be less than or equal to $2n-1$, where $n$ is the number of sites. The only time an arc can be added to the beachfront is via a site event. Each arc is associated with a parabola defined by a site and the sweep line. As the sweep line moves downward, the equations of the parabolas governing the arcs change, triggering a shift in the breakpoints of those arcs as well. The breakpoints trace out the Voronoi edges, which intersect at voronoi vertices. The vertices of the Voronoi diagram are added when we handle circle events, and a given vertex is located precisely the center of the circle associated with the event.\par

      % The second way the beachfront's structure changes is when an arc disappears. The disappearance of an arc coincides with the second type of event, called a \emph{circle event}. We'll define the notion of a circle event by studying a small portion of the beachfront. Consider the arcs $\alpha$, $\delta$, and $\gamma$ defined by three sites $p_{i}$, $p_{j}$, and $p_{k}$. Define the circle, $C$ with the three sites $p_{i}$, $p_{j}$, $p_{k}$. [You should probably remind the reader why $\alpha$ and $\gamma$ are not arcs from the same site, also why the circle contains no sites] Though the reasons aren't immediately obvious, we want to keep track of two points: the center of the circle, $q$, and the lowest point of the circle, $l$. If $\delta$ is the arc that is shrinking, when does it disappear? Recall that the center of the circle, $q$, is equidistant from $p_{i}$, $p_{j}$, $p_{k}$ and $l$. When the sweep line, $s$, reaches $l$, the arcs correspoinding to $p_{i}$ and $p_{k}$, $\alpha$ and $\gamma$, respectively, intersect at $q$. [Do I need to explain in more detail why, or can I *just* include a diagram]. At this point, the right breakpoint of $\alpha$ and the left breakpoint of $\gamma$ become equal to the left and right breakpoints of $\delta$, $\delta$ disappears. The edges traced out by the breakpoints of $\delta$ meet at $q$ and $q$ becomes a Voronoi vertex.\par
      % To summarize, a site event occurs when the sweep line intersects with a site (i.e they both have the same y-coordinate) and a circle event occurs when the sweep line intersects with the lowest point (that is to say, the point with the minimum y-coordinate) of a circle. Arcs are added to the beachfront when site events occur, and removed when circle events occur. The effect of an adding an arc is the growth of a new edge, and the effect of removing an arc is the addition of a vertex.\par
      % It's important to note that in this example, we assumed that $p_{i}$, $p_{j}$, $p_{k}$ were non-collinear sites, since the circle defined by three collinear points would be a circle of infinite radius (that is to say, a line). Moreover, we glossed over the possibility that $C$ contained any other sites. How would any number of sites on the interior of $C$ affect the circle event itself? \par 
      % To answer this question, let's first make a brief digression and introduce the second structure that Fortune's algorithm employs: the \emph{event queue}. Armed with an understanding of how site events and circle events effect the structure of the beachfront, we can consider ourselves sufficiently motivated to define a structure that keeps track of these kinds of events. We know that the sweep line travels downward, handling site and circle events as it encounters them. In fact, we know a lot about the site events; since we know all the sites before the sweep line begins, we can simply order the sites by decreasing y-coordinate and initialize the event queue with that infomation. Unlike site events, we don't know exactly when or how many circle events will occur\footnote{Though we can provide an upper bound, see \cref{vertex_bounds}}, so they complicate the problem insofar as they punctuate the otherwise predictable order of site events. What we do know is that we'd like to maintain an event queue, which consists of---and is ordered by---all of the site events and the known circle events.  Circle events are added to event queue for every triple of consecutive arcs on the beachfront. So when a site event triggers a new arc on the beachfront, we need to check a couple of things, namely, whether or not the new arc:
      % \begin{itemize}
      % \item invalidates one or more circle events already in the event queue; or
      % \item creates one or more circle events
      % \end{itemize}. Often, handling a site event often has a cascading effect, wherein the event itself doesn't create a circle event, but it might create a situation where one or more circle events would need to added or removed from the event queue. Similarly, handling a circle event can also lead to the creation or removal of one or more circle events, since the disappearance of an arc can lead to new combinations of triples on the beachfront. Note that a circle event exists in the event queue if and only if it satisfies:
      % \begin{itemize}
      % \item the property that the circle defined by the sites corresponding to the triple of arcs intersects the sweep line; and
      % \item hasn't already been deleted from the event queue
      % \end{itemize}.

      % [Probably don't need this anymore .... Now that we have an event queue to keep track of the order of circle and site events, we can look back at our initial example. Let $p_{m}$ be a site located somewhere on the interior of our original circle, $C$. As $s$ crept downward, the site event corresponding to $p_{m}$ would have been handled before circle event at $l$. As a result, an arc $\beta$ would have been inserted somewhere between $\alpha$, $\delta$, and $\gamma$. More specifically, the arc directly above $p_{m}$ would have been split into two arcs. The only exception to this would be the edge case where $p_{m}$'s x-coordinate was exactly the same as either of the breakpoints of $\delta$. In that case, the arc wouldn't have split $\delta$; it would have been inserted directly in between $\delta$ and the appropriate adjacent arc. If this were the case, the triple of arcs whose corresponding sites had defined the circle would no longer exist, so the circle event would be invalid. In the former scenario, the new arc would have created at least one new triple of arcs, which would have prompted the creation of more circles, and thus cicle events. It's possible to show [do i have to?] that at least one of these new circle events would have been handled before our original circle event...]
    % subsection putting_it_all_together (end)
  \clearpage

  \subsection{Algorithm Pseudocode} % (fold)
  \label{sub:sweep_algorithm_pseudocode}
    \nameref{VoronoiSweepline} and its supporting procedures, \nameref{HandleSiteEvent} and \nameref{HandleCircleEvent}, provide a pseudocode implementation of Fortune's algorithm. Other supporting procedures, such as \textsc{NextEvent, RemoveCircle, SplitArcInsert, GetLeftArc, GetRightArc, DetectCircleEvent, AddEdge}, among others, will allow us to gloss over the details of the code and to focus on the intention of the procedure at hand. The vertex and edge structure for $\mbox{Vor}(P)$ will use a doubly connected edge list (DCEL), as described in \cref{sub:half_edge_ds}. A common structure used to maintain the beachfront, $\beta(P)$, is some flavor of a balanced binary search tree (BBST); \citealp{deberg} uses a Red-Black Tree, and we assume the same. As we saw in \cref{ssub:events}, the event queue, $Q$, will be a priority queue, which can be implemented in a multitude of ways.\par
    
    \begin{algorithm}[H]
    \caption{\textsc{VoronoiSweepline}}\label{VoronoiSweepline}
    \begin{algorithmic}[1]
    \Require Set of sites, $P$, which are in \emph{general position}
    \Procedure{VoronoiSweepline}{$P$}\Comment{Construct $\mbox{Vor}(P)$}
    \State $Q\gets P$ \label{init_q} \Comment{Initialize event queue, $Q$, with set of sites, $P$}
    \State $E\gets \{\}$ \label{init_e} \Comment{Initialize (empty) DCEL}
    \State $\beta\gets \{\}$\Comment{Initialize (empty) beachfront} \label{init_b}
    \While{$Q$ is not empty} \label{vs_while}
      \State $e\gets$ \Call{NextEvent}{$Q$}
      \If{$e$ is a site event}
        \State\Call{HandleSiteEvent}{$e$}\Comment{e is a site $p$}
      \Else
        \State\Call{HandleCircleEvent}{$e$}\Comment{$e$ is a circle, $c$}
      \EndIf
    \EndWhile \label{vs_while_end}
    \EndProcedure
    \end{algorithmic} 
    \end{algorithm}

    \nameref{VoronoiSweepline} is the conductor of this symphony. In lines \ref{init_q}, \ref{init_e}, and \ref{init_b}, we initialize our major structures. $\beta$ is an empty RB-Tree, and E is an empty list of directed half edges. After this step, $Q$ is a priority queue populated with the site events. The main goal of the \nameref{VoronoiSweepline} procedure is to handle all of the events in the event queue. As we will see in \nameref{HandleSiteEvent} and \nameref{HandleCircleEvent}, calls to \textsc{DetectCircleEvent, RemoveCircleFor} and \textsc{RemoveCircle} will add and remove circle events from the event queue as necessary. As long as there are events in $Q$, we assign the variable $e$ to the result of calling \textsc{NextEvent} with $Q$ as an argument. The \textsc{NextEvent} function returns the event with the highest priority-- that is to say, with the maximum y-coordinate-- from $Q$.\par

    \begin{algorithm}[H]
    \caption{\textsc{HandleSiteEvent}}\label{HandleSiteEvent}
    \begin{algorithmic}[1]
    \Procedure{HandleSiteEvent}{$p$}
    \If {$\beta$ is empty} \label{b_empty}
      \State \Call{Insert}{$\beta$, $p$}
      \State \textbf{return}
    \Else
      \State $\alpha\gets$ \Call{GetArcAbove}{$\beta$, $p$} \Comment{Get the arc above this site}
      \If {\Call{HasCircle}{$\alpha$}}\Comment{Remove false alarm if necessary}
        \State \Call{RemoveCircle}{$Q$, $\alpha$}
      \EndIf 
      \State $\textit{new\_arc}\gets$ \Call{SplitArcInsert}{$\beta$, $\alpha$, $p$}\label{split_insert}
      \State $\textit{left\_arc}\gets$\Call{GetLeftArc}{$\beta$, $\textit{new\_arc}$} \label{get_left}
      \State $\textit{right\_arc}\gets$\Call{GetRightArc}{$\beta$, $\textit{new\_arc}$} \label{get_right}
      \State \Call{AddEdge}{$E$, $\textit{left\_arc}$, $\textit{new\_arc}$} \Comment{Add new edges} \label{add_left}
      \State \Call{AddEdge}{$E$, $\textit{new\_arc}$, $\textit{right\_arc}$} \label{add_right}
      \State \Call{DetectCircleEvent}{$Q$, $\beta$, $\textit{left\_arc}$} \Comment{Add new circle events}
      \State \Call{DetectCircleEvent}{$Q$, $\beta$, $\textit{right\_arc}$} 
    \EndIf
    \State \Call{TidyUp}{$E$, $\beta$}\Comment{Create cells and handle what remains of the beachfront}
    \State \textbf{return} $E$
    \EndProcedure
    \end{algorithmic} 
    \end{algorithm}

    If $e$ is a site event, we enter the \textsc{HandleSiteEvent} procedure, which takes site event, $p$, as its only argument; though we retain access to the major structures of $\mbox{Vor}(P)$, namely: $Q$, $\beta$, and $E$. In line \ref{b_empty}, we check to see whether or not this is the first arc in the beachfront. If it is, we call the \textsc{Insert} function with the beachfront and the site, which inserts an arc associated with $p$ into $\beta$. Otherwise, let $\alpha$ be the arc in the beachfront directly above $p$. If there was a circle event associated with this arc already, then we need to remove it, since this circle event has become a false alarm.\par

    Line \ref{split_insert} is a dense one. In this line, we make a call to \textsc{SplitArcInsert}, which creates and returns an arc, $\textit{new\_arc}$, associated with $p$ and also splits the arc above $p$, $\alpha$, into two arcs (as in \cref{fig:site_event_cases0} where $\alpha$ splits into $\alpha'$ and $\alpha''$). In the RB-Tree, the effect of this is the replacement of a leaf node (representing the arc $\alpha$) with a subtree whose three leaves store $\alpha'$, $\textit{new\_arc}$, and $\alpha''$. The internal (non-leaf) nodes of this subtree stores the breakpoints of the left and right child arcs. [probably should make a figure of this]. Since we are using an RB-tree, some re-balancing might be necessary (though outside the scope of this thesis), but we will assume that \textsc{SplitArcInsert} takes care of that.\par

    The remainder of \textsc{HandleSiteEvent} involves making the proper updates to $E$ and $Q$. In lines \ref{get_left} and \ref{get_right} we get the arcs to the left and right of $\textit{new\_arc}$, which constitutes searches for the predecessor and successor leaf nodes with respect to  $\textit{new\_arc}$ in $\beta$. Note that these arcs will be $\alpha'$ and $\alpha''$, respectively. As we saw in the previous sections, the addition of an arc to the beachfront provokes the beginning of two new edges, specifically, the left edge traced out by the intersection of $\textit{left\_arc}$ and $\textit{new\_arc}$; and the right edge traced out by the intersection of $\textit{new\_arc}$ and $\textit{right\_arc}$. In lines \ref{add_left} and \ref{add_right} we add these edges to $E$. Finally, we evaluate whether or not there are new circle events which need to be added to $Q$. A call to \textsc{DetectCircleEvent} with arguments $queue$, $beachfront$, and $arc$ determines whether or not there is a circle event with the triple of arcs $(\textsc{GetLeftArc}(arc),\;arc,\;\textsc{GetRightArc}(arc))$. If there is, it creates the event, adds it to $queue$, and associates it with $arc$. Recall that there isn't a valid circle event associated with $\textit{new\_arc}$, since the arcs to its left and right are associated with the same site. So we only need to check for two possible circle events: the event where the middle arc is $\textit{left\_arc}$, and the event where the middle arc is $\textit{right\_arc}$.\par

    \begin{algorithm}[H]
    \caption{\textsc{HandleCircleEvent}}\label{HandleCircleEvent}
    \begin{algorithmic}[1]
    \Procedure{HandleCircleEvent}{$c$}
    \State $\alpha\gets$\Call{GetArcAbove}{$\beta$, $c$}\label{get_arc}
    \State $\textit{left\_arc}\gets$\Call{GetLeftArc}{$\beta$, $\alpha$}
    \State $\textit{right\_arc}\gets$\Call{GetRightArc}{$\beta$, $\alpha$}
    \State $\textit{left\_edge}\gets$ \Call{GetEdge}{$E$, $\textit{left\_arc}$, $\alpha$}
    \State $\textit{right\_edge}\gets$ \Call{GetEdge}{$E$, $\alpha$, $\textit{right\_arc}$}
    \If {\Call{HasCircleFor}{$left$, $\alpha$}}\label{rm_start}
      \State \Call{RemoveCircle}{$Q$, $left$}
    \EndIf
    \If {\Call{HasCircleFor}{$right$, $\alpha$}}
      \State \Call{RemoveCircle}{$Q$, $right$}
    \EndIf  \label{rm_end}
    \State \Call{RemoveArc}{$\beta$, $\alpha$}
    \State $\textit{new\_vert}\gets$ \Call{AddVertex}{$E$, $c.center$}\label{new_vert} \Comment{Insert a new vertex into $E$}
    \State $\textit{new\_edge}\gets$ \Call{AddEdge}{$E$, $\textit{left\_arc}$, $\textit{right\_arc}$}\label{new_edge}
    \State \Call{SetEdgeSrc}{$\textit{new\_edge}$, $\textit{new\_vert}$} \label{set_src}
    \State \Call{SetEdgeDest}{$\textit{left\_edge}$, $\textit{new\_vert}$}\label{update_left} \Comment{Update edges of removed arc}
    \State \Call{SetEdgeDest}{$\textit{right\_edge}$, $\textit{new\_vert}$}\label{update_right}
    \State \Call{DetectCircleEvent}{$Q$, $\beta$, $\textit{left\_arc}$}
    \State \Call{DetectCircleEvent}{$Q$, $\beta$, $\textit{right\_arc}$} 
    \EndProcedure
    \end{algorithmic} 
    \end{algorithm}

    If $e$ is a circle event, we handle it by calling \textsc{HandleCircleEvent}, which takes a circle, $c$, as its argument. There is an arc associated with this circle event: it is the arc which will be removed. In line \ref{get_arc} we retrieve this arc (which is the arc located directly above $c$'s lowest point $\ell$) and assign it to a variable $\alpha$. Since we are removing $\alpha$ from the beachfront, the circle events on associated with its adjacent arcs (\textit{left\_arc} and \textit{right\_arc}) are invalid if they involve $\alpha$. In lines \ref{rm_start} through \ref{rm_end} we perform this check and remove the offending circle events from $Q$. We also make the crucial change to the beachfront in the next line: removing $\alpha$ from $\beta$.\par

    Similar to the \textsc{HandleSiteEvent} procedure, the rest of \textsc{HandleCircleEvent} involves updating $Q$ and $E$ to reflect the circle event and the corresponding change in the beachfront. We know that a handled circle event signifies the discovery of a Voronoi vertex at the center of that circle. In line \ref{new_vert}, we make a call to the helper function \textsc{AddVertex} save the inserted vertex as \textit{new\_vert}. \textsc{AddVertex} takes as its arguments an edge list and a location; it creates a new vertex associated with that location, adds it to the edge list, and returns that vertex. Also note that the removal of $\alpha$ from $\beta$ yields a new pair of breakpoints: \textit{left\_arc} and \textit{right\_arc} are now adjacent to each other, and as such their intersection represents the formation of a new edge. We add this edge in line \ref{new_edge}. Further, we know that \textit{new\_vert} is the source of \textit{new\_edge}, so we update \textit{new\_edge}'s source vertex in line \ref{set_src}. Recall that \textit{new\_vert} is also the point where the left and right edges traced out by the breakpoints of the removed arc meet. In lines \ref{update_left} and \ref{update_right}, we update these edges with this new information by setting the destinations of \textit{left\_edge} and \textit{right\_edge} to \textit{new\_arc}.\footnote{This footnote is for the detail-oriented reader, who might object to my \textsc{SetEdgeDest} function, crying out: \say{But in \cref{sub:half_edge_ds} you said that we only care about the source of an edge, not the destination! Conveniently, you've left the entire notion of edge twins out of this discussion! What's with that?} And to that, I say: \say{I'm sorry}. I was only trying to make things simpler. You see, we've been dealing with half edges the whole time. When we call \textsc{AddEdge}(\textit{left},\textit{right}), we create a pair of half edges between those arcs, [CLARIFY] one edge normal to the site associated with \textit{left} and the site associated with \textit{right} and another half edge normal to site associated with \textit{right} and the site associated with \textit{left}. So \textsc{AddEdge} return the half-edge normal to the sites associated with \textit{left} and \textit{right}. When we call \textsc{SetEdgeDest}(\textit{edge}, \textit{dest}), we are actually setting the source of \textit{edge.twin}.} Finally, we need to see if the removal of $\alpha$ triggered any new circle events, so in the final two lines of the procedure we call \textsc{DetectCircleEvent} on both of the arcs previously adjacent to $\alpha$.\par

    Though there are no more events left in $Q$, we might not have removed all of the arcs in $\beta$. The remaining leaves in $\beta$ are the arcs which were not removed by any circle event. The internal nodes of $\beta$ represent the breakpoints of its corresponding child arcs, which we know to be Voronoi edges. However, since these arcs were never removed from the beachfront via a circle event, they might not have their source or destination vertices set. We take the edges defined by the internal nodes of the beachfront to be the half infinite edges in the diagram. A call to \textsc{TidyUp} assigns the endpoints of these edges to be the vertex at infinity. It also \say{audits} $E$, connecting half-edges into cells describing a Voronoi region by setting the $next$ attribute of a half edge. Often, \textsc{TidyUp} will also calculate a bounding box for $\mbox{Vor}(P)$ and find the intersections of the half-infinite edges with the bounding box. 
  % subsection sweep_algorithm_pseudocode (end)

  % \subsection{Final thoughts on Fortune's Algorithm} % (fold)
  % \label{sub:final_thoughts_on_fortune_s_algorithm}
  %   Though Fortune's algorithm wasn't the algorithm I spent the most time with on this thesis, it remains my favorite algorithm to witness. Fortune's algorithm reveals- more readily than any other I've encountered- the connection between sorting a set of numbers and computing the Voronoi diagram. [the connection]
  %   [perhaps a note on degenerate cases]
  %   [a note on space and time complexity] 
  % subsection final_thoughts_on_fortune_s_algorithm (end)
  % section fortune_s_algorithm (end)

  \clearpage

  \chapter*{Constructing the Delaunay Triangulation}
    \addcontentsline{toc}{chapter}{Constructing the Delaunay Triangulation}
    \chaptermark{Constructing the Delaunay Triangulation}
    \markboth{Constructing the Delaunay Triangulation}{Constructing the Delaunay Triangulation}
    \setcounter{chapter}{3}
    \setcounter{section}{0}
  \section{A Divide and Conquer Approach} % (fold)
  \label{sec:divide_and_conquer}
    Guibas and Stolfi's \say{Primitives for the Manipulation of General Subdivisions and the Computation of Voronoi Diagrams}, \citealp{guibas}, presents a detailed and comprehensive presentation of the Voronoi and Delaunay diagrams. They offer a divide and conquer approach to the construction of Voronoi or Delaunay diagrams-- using their quad-edge structure-- whose time and space complexity is consistent with the bounds known to be optimal in the worst case.\footnote{Recall that the Voronoi diagram of $n$ sites can be computed in $\mathcal{O}(n\log n)$ time and occupying $\mathcal{O}(n)$ space, and these bounds are TIGHT!} As we saw in \cref{sec:how_do_we_keep_track_of_this}, it's also easy for us to witness its elegance, as theirs is a data structure which represents both the Voronoi diagram and its dual simultaneously. Their quad-edge data structure, furthermore, supports the arbitrary construction and modification of any embedded graph on a two-dimensional manifold. For the purposes of computing the Delaunay triangulation (and implicitly, the Voronoi diagram)  Guibas and Stolfi introduce two geometric predicates which enforce the \say{interesting} properties; these predicates ensure that the faces (composed of edges in the graph) maintain the Delaunay property.

  \subsection{Algorithm Sketch}
  \label{sub:gs_sketch}
    Like other divide and conquer algorithms, Guibas and Stolfi's approach to constructing a Delaunay Triangulation relies on repeated partitioning of the problem's data until each partition conforms to a trivial (or base) case.

    So, given a set of sites and a desire to compute the Delaunay triangulation of that set, we begin. Though \say{divide and conquer} might lead you to believe that this approach consists of two stages, Guibas and Stolfi proceeds in three stages. First, we have the \say{split,} or \say{divide,} stage, in which we split the large problem of computing the Delaunay of $P$ into smaller subproblems. The second stage involves two recursive steps: we apply Guibas and Stolfi's algorithm to each of the two partitions and thus compute the Delaunay triangulation of each. Finally, we proceed to the \say{merge} phase, which carefully combines the triangulations of the partitions into a final triangulation on all $n$ sites. The algorithm is implemented recursively, and we will discuss how the algorithm leverages recursion and handles these base cases shortly. \par

  \subsubsection{Split!}
  \label{ssub:split}
    We assume two things: that the $x$-coordinate of each site in $P$ is unique, and that the sites are in \emph{general position},\footnote{As discussed in \cref{sec:general_position}.} meaning that there will be no degenerate cases for us to handle. We seek a vertical line by which we will recursively partition the set of sites. This yields a left site set and a right site set, $L$ and $R$, respectively. We sort the sites by x-coordinate and choose the median value. \Cref{fig:del_partition0} illustrates how the recursive splitting of $P$ plays out. Note that in this example, some of the sites have very similar x-coordinates. In cases where we can't assume $x$-coordinates are unique, we may break the \say{tie}, so to speak, by comparing the $y$-coordinates of the sites. \Cref{fig:del_partition1} illustrates how subproblems of size two or three are triangulated. \par 
    \begin{figure}[!htb]
    \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/partition_0.tex}
        \caption{Choosing the partitions of $P$. The filled circles are the sites of $P$, and the unfilled circles are the sites projected onto the x-axis. The darkest vertical line is the first partition, separating $P$ into $L$ and $R$. The two gray lines are the partitions of the resulting subproblems, and the four lightest lines the medians separating the four subproblems generated from the gray lines.}
        \label{fig:del_partition0}
      \end{subtable}

      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/partition_1.tex}
        \caption{Solving (triangulating) the subproblems.}
        \label{fig:del_partition1}
      \end{subtable}
      \caption{Dividing $P$ into subproblems we know how to solve}
      \label{fig:div_and_triangulate}
    \end{figure}

    Note that once the size of the set of sites we are operating on reaches two or three, we do not try to partition it further. At this stage, we consider sets of sites with size two or three to be subproblems which conform to one of two base cases. The concept of a base case is central to recursive algorithms, because the base case(s) of a recursive algorithm are what ensure that the algorithm terminates-- that no further recursive calls are made. In Guibas and Stolfi's divide and conquer algorithm, we have two base cases: the situations where $|P|$ is either two or three. When either of these is true, we immediately recognize that the Delaunay triangulation of $P$ is trivial. In the case of two sites, it is a line segment connecting the two sites; in the case of three sites, it is the triple of segments connecting the sites into a triangle.\par

    To summarize, we began with a set of sites, $P$, where $\mid P\mid = n$. We sorted the sites by x-coordinate, and split the set of sites into left and right halves according to the median x-value. We continued to do this until the solution to the problem was a trivial one, at which point we returned the triangulation. At this point, we have a collection of valid Delaunay diagrams on subsets of $P$; our next task will be to understand how they can be combined into the final triangulation $D_{P}$.

  \subsubsection{Merge!}
  \label{ssub:merge}
    The merge step of Guibas and Stolfi's algorithm is one of the more computationally expensive portions of their approach, and we'll soon understand why. This stage aims to knit the triangulations together pairwise in the order they were partitioned while also maintaining the Delaunay property. So for a given pair of diagrams, say $D_{L}$ and $D_{R}$, the task of determining how $D_{L}$ and $D_{R}$ are connected falls to the merge step of the algorithm. Any given merge step, then, operates on two adjacent, valid, Delaunay triangulations, which have been separated by a known bisector, which we discussed in \cref{subsub:Divide}. To provide you, dear Reader, with a visual intuition of what the merge step entails, I have included \cref{fig:del_merge_not_final}. \Cref{fig:del_merge0} illustrates the first iteration of the merge step; it knits together the eight subproblems in \cref{fig:del_partition1} into four subproblems. \Cref{fig:del_merge1} shows results of the second pass: it combines the diagrams to the left of the dashed vertical line into a single diagram, and, in a similar fashion, combines the pair to the right of the line as well. Note that the dotted lines in \cref{fig:del_partition0,fig:del_partition1} are edges which had to be removed in order to maintain the delaunayhood of the merged diagram.  One of our goals in this section will be understand how Guibas and Stolfi apply the \emph{empty circle property}-- introduced in \cref{sec:the_voronoi_diagram_and_its_dual}-- to determine which, if any, edges need to be removed during the merge process.\par

    \begin{figure}[!htb]
    \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/merge_0.tex}
        \caption{Merging the adjacent subproblems. Note the gray dotted line segment in the second pair from the left. We needed to remove that edge in order to maintain the Delaunay property of the merged result of the pair.}
        \label{fig:del_merge0}
      \end{subtable}

      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/merge_1.tex}
        \caption{Merging the adjacent pairs from \cref{fig:del_merge0}. Again, the dotted line segments are removed to maintain the Delaunay propertry.}
        \label{fig:del_merge1}
      \end{subtable}
      \caption{Merging subproblems pairwise.}
      \label{fig:del_merge_not_final}
    \end{figure}

    To understand precisely how the merge step works, we will break it down into two more steps. First, we find the \emph{lower common tangent} of $D_{L}$ and $D_{R}$. The lower common tangent is the lowest line which is\begin{inparaenum}[\itshape a\upshape)] a) tangent to the polygons formed by the boundary of the convex hull; and b) the line does not intersect either polygon.\end{inparaenum} For our purposes the lower common tangent is also the edge which spans $D_{L}$ and $D_{R}$ and is the first valid edge of the merged result, $D_{P}$, as in \cref{fig:lct}. We know this edge to be valid because the lower and upper common tangents of $D_{L}$ and $D_{R}$ can easily be shown to be edges of the convex hull of the sites in $P$, that is, $L \cup R$. The lower common tangent can be found in linear time in the combined sizes of the hulls of $L$ and $R$. Once we have the lower common tangent, we wish to determine what the first \emph{cross-edge} will be. We will think of the cross edges as the edges which connect $D_{L}$ and $D_{R}$, and if we choose them carefully, we can maintain the delaunayhood of the diagram.\par

    \begin{figure}[!htb]
      \centering
      \input{figs/ch1/guibas/lct.tex}
      \caption{Lower Common Tangent, $lct$, of $D_{L}$ and $D_{R}$}
      \label{fig:lct}
    \end{figure}

    So, how do we choose these edges? Given \emph{basel}, the directed edge connecting $D_{L}$ and $D_{R}$, whose endpoints are those of $lct$, as in \cref{fig:lct}; we will perform the second part of the merge step, which utilizes the notion of a \emph{rising bubble} to maintain the Delaunay property. The name reflects the conceptual actions we're about to perform: the rising bubble exists in the algorithm as the series of circle tests performed (roughly) along the vertical line separating $D_{L}$ and $D_{R}$. Recall that we can perform a series of circle tests to enforce the Delaunay condition, which states that a triangulation is Delaunay if and only if the circumcircle of every interior triangle is point-free (that is, contains no other sites).

    Before we create the \emph{rising bubble}, recall that \emph{basel} is a directed half-edge\footnote{As discussed in \cref{sec:how_do_we_keep_track_of_this}.} going from $rdi.twin.source$ to $ldo.source$, as in \cref{fig:del_knit_0}. The first circle we create uses the left and right endpoints of \emph{basel}. Recall that the vertices of the diagram we are using are located in $D_{R}$ and $D_{L}$, respectively. Since \emph{basel} is a directed edge, the vertices which serve as two inputs to our circle test can also be referred to as \emph{basel.source} and \emph{basel.twin.source}.\par

    We introduce two more edges which we will use throughout this portion of the algorithm. $\ell$ is the next edge in $D_{L}$ to be encountered by the rising bubble. Similarly, $r$ is the next edge in $D_{R}$ to be encountered by the bubble. At the outset of this procedure, we set $\ell$ to be \emph{basel.twin.onext()} where \emph{onext()} is conveniently defined to be a function which returns the next edge out of the vertex \emph{basel.twin.source}. At this point, we'd like to know whether or not $\ell$ is valid edge. \par 

    What does it mean for an edge to be \emph{valid}? A candidate edge is valid if the edge is located \say{above} \emph{basel}. That is to say, if we took the destination vertex of a given edge $e$ (which we can get easily with \emph{e.twin.source}) and the endpoints of \emph{basel}, the three vertices need to be ordered in a counterclockwise orientation. This predicate, referred to by Guibas and Stolfi as \textsc{CCW} is implemented as:
    $$
    CCW(A,B,C) =
    \begin{vmatrix}
    x_{A} & y_{A} & 1 \\
    x_{B} & y_{B} & 1 \\
    x_{C} & y_{C} & 1 \\  
    \end{vmatrix} > 0.
    $$  

    So, in the case of determining whether or not $\ell$ is valid, we check its validity by ensuring that \textsc{CCW}($\ell.twin.source$, $basel.twin.source$, $basel.source$) is greater than 0. If $\ell$ is valid, then we may continue to the next step, which involves \say{pruning} $D_{L}$ in an appropriate way. What we need to do is consider whether or not any of edges from \emph{$\ell.source$}-- including $\ell$-- intersect with the cross edge we'd like the insert. To do this we use the \textsc{InCircle} test, the second geometric predicate that Guibas and Stolfi use. 

    The \textsc{InCircle} test takes as its arguments four sites, $A$, $B$, $C$, and $D$, and envisions a counterclockwise oriented circle $ABC$ and a lonely point $D$. The \textsc{InCircle} is defined by Guibas and Stolfi as follows: \say{\textsc{InCircle}($A$, $B$, $C$, $D$) is defined to be true if and only if point $D$ is interior to the region of the plane that is bounded by the oriented circle $ABC$ and lies to the left of it.} 
  
    If we wish to think about it in terms of the coordinates of $A$, $B$, $C$, and $D$, the \textsc{InCircle} predicate is equivalent to:
    $$
    InCircle(A,B,C,D) =
    \begin{vmatrix}
    x_{A} & y_{A} & x_{A}^2 + y_{A}^2 & 1 \\
    x_{B} & y_{B} & x_{B}^2 + y_{B}^2 & 1 \\
    x_{C} & y_{C} & x_{C}^2 + y_{C}^2 & 1 \\  
    x_{D} & y_{D} & x_{D}^2 + y_{D}^2 & 1 \\  
    \end{vmatrix} > 0.
    $$  

    Now the notion of using circles to enforce, or as we might say \emph{witness}, the delaunayhood of a certain edge, is not new. The \textsc{InCircle} predicate is precisely the circle test we performed in \cref{sec:the_voronoi_diagram_and_its_dual} and saw in \cref{fig:delaunayhood_small}. When we apply this notion of the \textsc{InCircle} to determining whether or not $\ell$ will remain in the merged diagram $D_{P}$, we will do so as follows: if \textsc{InCircle}($basel.twin.source$, $basel.source$, $\ell.twin.source$, $\ell.onext().twin.source$) then $\ell.onext().twin.source$ is in the circle defined by \emph{basel.twin.source}, $basel.source$, and $\ell.twin.source$, which means that we must delete the edge $\ell$ and set the new value of $\ell$ to be $\ell.onext()$. We continue to do this, deleting edges as necessary, until the \textsc{InCircle} test fails. Then, we repeat an analagous procedure for $r$.

    [final summarizing paragraph...]

    \begin{figure}[!htb]
      \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit0.tex}
        \caption{First edge, $basel$, of $D_{P}$ and $\ell$, candidate edge in $D_{L}$. Note that $\ell$ is considered to be valid because \textsc{CCW}($\ell.twin.source$, $basel.twin.source$, $basel.source$) is true. That is to say, $\ell.twin.source$, $basel.twin.source$, $basel.source$ is a counterclockwise ordering.}
        \label{fig:del_knit0}
      \end{subtable}

    % \end{figure}
    % \begin{figure}[!htb]
    %   \ContinuedFloat
    %   \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit1.tex}
        \caption{Evaluating whether or not $\ell$ will be in $D_{P}$. The dashed arc is a portion of the ``rising bubble'' which we say has \emph{witnessed} that $v$ in not in the circle defined by $\ell.twin.source$, $basel.twin.source$, and $basel.source$.}
        \label{fig:del_knit1}
      \end{subtable}
    % \end{figure}
    % \begin{figure}[!htb]
    %   \ContinuedFloat
    %   \centering

      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit2.tex}
        \caption{Similarly, now we evaluate whether or not $r$ will be in $D_{P}$. Note that it is a valid edge, since $r.twin.source$, $basel.twin.source$, $basel.source$ is a counterclockwise ordering.}
        \label{fig:del_knit2}
      \end{subtable}
    \end{figure}

    % \clearpage
    \begin{figure}[!htb]
      \ContinuedFloat
      \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit3.tex}
        \caption{Evaluating whether or not $r$ will be in $D_{P}$. The dashed arc is a portion of the ``rising bubble'' which we say has \emph{witnessed} that $u$ in not in the circle defined by $r.twin.source$, $basel.twin.source$, and $basel.source$.}
        \label{fig:del_knit3}
      \end{subtable}

    % \end{figure}
    % \begin{figure}[!htb]
    %   \ContinuedFloat
    %   \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit4.tex}
        \caption{Since $\ell$ and $r$ are both valid we perform \textsc{InCircle}($\ell.twin.source$, $\ell.source$, $r.source$, $r.twin.source$). Note that $r.twin.source$ is not in the circle formed by $\ell.twin.source$, $\ell.source$, $r.source$, so \textsc{InCircle} returns false.}
        \label{fig:del_knit4}
      \end{subtable}
      %
    % \end{figure}
    % \begin{figure}[!htb]
    %   \ContinuedFloat
    %   \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit5.tex}
        \caption{Due to the result of the \textsc{InCircle} test, we update \emph{basel}'s destination to $\ell.twin.source$. We also update $\ell$ to $basel.twin.onext()$.}
        \label{fig:del_knit5}
      \end{subtable}
    \end{figure}

    \begin{figure}[!htb]
      \ContinuedFloat
      \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit6.tex}
        \caption{We continue this process noting that $\ell$ is a valid edge. Because this is the case, we check to see if $v$, that is, $\ell.onext().twin.source$, is contained in the circle represented by the dashed lines. It is.}
        \label{fig:del_knit6}
      \end{subtable}

    % \end{figure}
    % \begin{figure}[!htb]
    %   \ContinuedFloat
    %   \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit7.tex}
        \caption{Because $v$ is contained in the circle, we need to remove $l$ and set the new value of $l$ to $l.onext()$, and making the analagous change for $v$. Note $l.onext()$ is also shown as a directed edge.}
        \label{fig:del_knit7}
      \end{subtable}
      % \caption{Knitting together $D_{L}$ and $D_{R}$ to form $D_{P}$}
      % \label{fig:del_knit_all}

    % \end{figure}
    % \begin{figure}[!htb]
    %   \ContinuedFloat
    %   \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit8.tex}
        \caption{We perform the same test again, checking to see if $v$ is contained in the dashed circle. This time, it is not, so we know that $\ell$ will be in $D_{P}$.}
        \label{fig:del_knit8}
      \end{subtable}
    \end{figure}

    \begin{figure}[!htb]
      \ContinuedFloat
      \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit9.tex}
        \caption{We consider the right side again, noting that $r$ is still valid. We may note that $u$ has not been reassigned. However, since $basel$ has changed, we need to check that $u$ is not in the circle formed by $r.twin.source$, $basel.twin.source$, and $basel.source$. Here, it is not.}
        \label{fig:del_knit9}
      \end{subtable}
    
    % \end{figure}
    % \begin{figure}[!htb]
    %   \ContinuedFloat
    %   \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit10.tex}
        \caption{Again, since $\ell$ and $r$ are both valid we perform \textsc{InCircle}($\ell.twin.source$, $\ell.source$, $r.source$, $r.twin.source$). Note that $r.twin.source$ is in the circle formed by $\ell.twin.source$, $\ell.source$, $r.source$, so \textsc{InCircle} returns true.}
        \label{fig:del_knit10}
      \end{subtable}

    % \end{figure}
    % \begin{figure}[!htb]
    %   \ContinuedFloat
    %   \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit11.tex}
        \caption{Because the \textsc{InCircle} test returned true, we update $basel$ so that its source is now $r.twin.source$. We also add the old $basel$ edge to $D_{P}$. Finally, we update $r$.}
        \label{fig:del_knit11}
      \end{subtable}
    \end{figure}

    \begin{figure}[!htb]
      \ContinuedFloat
      \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit12.tex}
        \caption{We continue in this manner until we reach the ``top'', that is, until the point when we reach the upper common tangent, shown here as $uct$. This will occur when both $l$ and $r$ are invalid.}
        \label{fig:del_knit12}
      \end{subtable}

    % \end{figure}
    % \begin{figure}[!htb]
    %   \ContinuedFloat
    %   \centering
      \begin{subtable}{\textwidth}
        \centering
        \input{figs/ch1/guibas/knit_done.tex}
        \caption{The finished diagram, $D_{P}$}
        \label{fig:del_knit_done}
      \end{subtable}
      \caption{Knitting together $D_{L}$ and $D_{R}$ to form $D_{P}$}
      \label{fig:del_knit_all}
    \end{figure}

    \clearpage


  \subsection{Divide and Conquer Algorithm Pseudocode} % (fold)
  \label{sub:divide_and_conquer_algorithm_pseudocode}
    \nameref{divconq_del} and its supporting procedures \nameref{del_merge} and \nameref{del_lct} provide a pseudocode implementation of the divide and conquer algorithm presented in Guibas and Stolfi's paper, \citealp{guibas}. The corresponding procedure for the dual is described in Shamos and Preparata's text, \citealp{shamos}.\par

    Because we are using Guibas and Stolfis quad-edge data structure, the operations around creating and manipulating the edge list are more complex than they would be if we were using a doubly connected edge list. However, using their structure not only gives us constant time access to both the Voronoi and Delaunay diagrams on $P$, it also allows us to dive a little more deeply into the topological underpinnings of subdivisions and manifolds.  \nameref{divconq_del} computes the Delaunay triangulation on a set of sites; however, it doesnt return return the entire edge structure. When we return $D$ at any point in \nameref{divconq_del}, we are returning two \say{handles} into the mesh. More precisely, we return the convex hull edge in the clockwise direction whose source is the rightmost vertex and the convex hull edge in the counterclockwise direction whose source is the leftmost vertex.\par
    
    \begin{algorithm}[H]
    \caption{\textsc{DelDivConq}}\label{divconq_del}
    \begin{algorithmic}[1]
    \Require Set of sites, $P$, which are in \emph{general position}
    \Procedure{DelDivConq}{$P$}\Comment{Construct $D_{P}$}
    \If{$|P|$ is 2} \Comment{First Base Case}\label{bc_1}
      \State $p_{1}$, $p_{2}\gets$ \Call{Sort}{P} \label{sort_1}
      \State $edge\gets$\Call{MakeEdge}{}\label{make_edge1}
      \State $edge.org$, $edge.dest \gets p_{1}$, $p_{2}$
      \State \textbf{return} $edge$, $edge.twin$ \label{return_1}
    \ElsIf{$|P|$ is 3} \Comment{Second Base Case}\label{bc_2}
      \State $p_{1}$, $p_{2}$, $p_{3}\gets$ \Call{Sort}{P}\label{sort_2}
      \State $e1\gets$\Call{MakeEdge}{}
      \State $e2\gets$\Call{MakeEdge}{$ $}
      \State \Call{Splice}{$e1.twin$, $e2$} \label{splice}
      \State $e1.org\gets p_{1}$
      \State $e1.dest\gets p_{2}$; $b1.org\gets p_{2}$
      \State $e2.dest\gets p_{3}$
      \State $e3\gets$\Call{Connect}{e2, e1}
      \If{\Call{CCW}{$p_{1}$, $p_{2}$, $p_{3}$}} \Comment{Make a triangle}
        \State \textbf{return} $e1$, $e2.twin$
      \ElsIf{\Call{CCW}{$p_{1}$, $p_{3}$, $p_{2}$}}
        \State \textbf{return} $e3$, $e3.twin$
      \Else \Comment{Case where are sites collinear}
        \State \textbf{return} $e1$, $e2.twin$ \label{return_2}
      \EndIf
    \Else \Comment{Recursive Case}\label{rc}
      \State $x\gets$\Call{Median}{$\{x\mid(x,y)\in\;P\}$}
      \State $L, R,\gets$ \Call{Split}{$P$, $x$}\Comment{Partition $P$ according to $x$}\label{split}
      \State $D_{L} \gets$ \Call{DelDivConq}{$L$}
      \Statex[2] $D_{R} \gets$ \Call{DelDivConq}{$R$}
      \State $D\gets$ \Call{DelMerge}{$D_{L}$, $D_{R}$}  \Comment{Merge sub-diagrams}
      \State \textbf{return} $D$\label{fin}
    \EndIf
    \EndProcedure
    \end{algorithmic} 
    \end{algorithm}

    As we saw in \cref{sub:gs_sketch}, the \nameref{divconq_del} is a recursive procedure which takes a set of sites $P$  in general position. We will also assume that not all sites are collinear, as special case we covered in \cref{sub:special_case}. Given $P$, \nameref{divconq_del} computes $\mbox{Del}(P)$ by splitting the problem into subproblems and then merging the results pairwise. Like all recursive procedures which intend to end, \nameref{divconq_del} has base cases. \par

    Lines \ref{bc_1} to \ref{return_1} outline the first base case. When the number of sites we are hoping to triangulate is equal to two, then the triangulation is a line segment. To determine the direction and orientation of the directed edge corresponding to this line segment, we first make a call to \textsc{Sort}(P) , which returns the set of sites sorted according to x-coordinate. In line \ref{make_edge1}, assign $edge$ to the result of \textsc{MakeEdge}. \textsc{MakeEdge} creates a generic, unconnected quad-edge. Recall the various attributes and functions on quad-edges covered in \cref{sub:quad_edge}. At this point, $edge$ has the following properties: $edge.org \neq edge.dest$, $edge.left = edge.right$, $edge.lnext = edge.rnext = edge.twin$, and $edge.onext = edge.oprev = e$. Now that we have made a single edge, $edge$ we return the pair $edge$, $edge.twin$. Since the diagram consists of just this single edge, $edge$, $edge.twin$ are the oppositely oriented leftmost and rightmost edges we should return.

    A slightly more complex base case, where there are only three sites in $P$, is outlined in lines \ref{bc_2} to \ref{return_2}. Our goal in this case is to try to form a triangle of edges with the correct orientation.  As in the previous case, our first order of business is to sort the sites by x-coordinate and assign them to $p_{1}$, $p_{2}$, and $p_{3}$, respectively. We make two generic edges, $e1$ and $e2$. \par

    The call to \textsc{Splice} on \ref{splice} is a mysterious one. \textsc{Splice} takes as its arguments two quad edges, $a$ and $b$, and operates on the rings of edges at the origins of $a$ and $b$. It also operates on rings of edges whose origins are the left faces of $a$ and $b$. If $a$ and $b$ have different origins, \textsc{Splice} has the effect of combining and ordering them appropriately. If the origins are the same, \textsc{Splice} has the effect of splitting the ring of edges around the origin. It then does the same thing for the rings (of edges) whose origins are $a.left$ or $b.left$. \par

    At this point (line \ref{splice}), $e1$ and $e2$ are totally disconnected from the subdivision, so the effect of \textsc{Splice} is that it sets $e1.twin$ to be in the same ring as $e2$. In this particular case, if we were working with a doubly connected edge list, this could be done by setting $e1.twin.next$ to $e2$ and then by setting $e2.next$ to $e1.twin$. However, since we are working with a quad-edge structure, a bit more care has to be taken to ensure that these operations propagate appropriately to the dual. This is the last we'll see of \textsc{Splice}, as it will only be used implicitly (via the \textsc{Connect} procedure) in the rest of this \nameref{divconq_del}.\par

    After updating the source and destination vertices of the edges, we perform the \textsc{CCW} test to determine the orientation of the triangle. This also allows us to return the correct pair of edges. We create the final edge of the triangle with the \textsc{Connect} procedure. \textsc{Connect} takes two edges, $a$ and $b$, and returns an edge, $e$, whose source is $a.dest$ and whose destination is $b.org$. At this point, the left faces of $a$, $b$, and $e$ are the same. \par

    The final chunk of pseudocode, lines \ref{rc} to \ref{fin}, handle the recursive case. When there are more than three sites in $P$, we need to break the problem down further. We call \textsc{Median}, which takes set of the x-coordinates from the sites in $P$ and returns the median value. In line \ref{split}, we pass this value--- along with $P$--- to another helper function, \textsc{Split}. \textsc{Split} returns two sets of sites, $L$ and $R$ (where $L = {p \mid p.x \leq x}$). Then, we make the calls to \nameref{divconq_del} on both $L$ and $R$. Finally, we merge the results with \nameref{del_merge} and return the result.\par

    \begin{algorithm}[H]
    \caption{\textsc{DelMerge}}\label{del_merge}
     \begin{algorithmic}[1]
    \Procedure{DelMerge}{$D_{L}$, $D_{R}$}
    \State $ldo$, $ldi\gets D_{L}$
    \State $rdi$, $rdo\gets D_{R}$
    \State $basel\gets$ \Call{DelLCT}{$ldi$, $rdi$}\label{lct}
    \If {$ldi.org$ is $ldo.org$}
      \State $ldo\gets basel.sym$
    \EndIf
    \If {$rdi.org$ is $rdo.org$}
      \State $rdo\gets basel$
    \EndIf
    \Loop \label{rb}
      \State $\ell\gets basel.sym.onext$
      \If{\Call{Valid}{$\ell$}} \label{valid_l}
        \While{\Call{InCircle}{$basel.dest$, $basel.org$, $\ell.dest$, $\ell.onext.dest$}}\label{rm_l}
          \State $next\_\ell \gets \ell.onext$
          \State \Call{DeleteEdge}{$\ell$}
          \State $\ell \gets new\_\ell$
        \EndWhile
      \EndIf
      \State $r \gets basel.oprev$
      \If{\Call{Valid}{$\ell$}}
        \While{\Call{InCircle}{$basel.dest$, $basel.org$, $r.dest$, $r.oprev.dest$}}\label{rm_r}
          \State $next\_r \gets r.oprev$
          \State \Call{DeleteEdge}{$r$}
          \State $r \gets new\_r$
        \EndWhile
      \EndIf
      \If{not \Call{Valid}{$\ell$} and not \Call{Valid}{$r$}} \Comment{$basel$ is UCT}\label{ce}
        \State exit loop
      \EndIf
      \If{not \Call{Valid}{$\ell$} or \par
        \hskip\algorithmicindent\hskip\algorithmicindent(\Call{Valid}{$r$} and \Call{InCircle}{$\ell.dest$, $\ell.org$, $r.org$, $r.dest$})}\label{ce_1}
        \State $basel\gets$ \Call{Connect}{$r$, $basel.sym$} \label{ce_add1}
      \Else
        \State $basel\gets$ \Call{Connect}{$basel.sym$, $\ell.sym$} \label{ce_add2}
      \EndIf
    \EndLoop \label{rb_end}
    \State \textbf{return} $ldo$, $rdo$
    \EndProcedure
    \end{algorithmic} 
    \end{algorithm}

    \nameref{del_merge} takes two valid Delaunay triangulations and knits them together. Recall that $D_{L}$ and $D_{R}$ are each pairs of edges. In particular, keep in mind that $ldi$ is the convex hull edge coming out of the rightmost vertex in $D_{L}$, going in the counterclockwise direction. $rdi$ is the convex hull edge coming out of the leftmost vertex in $D_{R}$, going in the clockwise direction. We know that all of the vertices in $D_{L}$ are left of the vertices in $D_{R}$, so $ldi$ is to the left of $rdi$. Furthermore, we know that the convex hulls of $D_{L}$ and $D_{R}$ are not overlapping. As we saw in \cref{ssub:merge}, the lower common tangent of $D_{L}$ and $D_{R}$ is a convex hull edge, which we know must be in the merged result, $D$. \par

    This is as good a place to start as any. We begin by calling \nameref{del_lct} in line \ref{lct}, which returns $basel$, the appropriately directed and oriented quad-edge connecting the vertices of the lower common tangent. Conceptually, our goal is to walk the respective hulls of the adjacent diagrams until we find the lower common tangent. This is done with a series of \textsc{CCW} tests. The first \textsc{CCW} test on line \ref{left_of} is equivalent to asking whether or not the source of $rdi$ is left of $ldi$. If $rdi.org$ is to the left of $ldi$, then we need to take a step (in the clockwise direction) along the hull. This is accomplished in line \ref{inc_ldi} where we update $ldi$'s value to $ldi.lnext$. Recall that $ldi.lnext$ points to the next edge which has the same left face as $ldi$. Since the left face of $ldi$ is the region exterior to the convex hull, $ldi.lnext$ is the next edge on the hull. If the value of this \textsc{CCW} is not positive, we ask whether or not $ldi.org$ is right of $rdi$. If it is, then we advance $rdi$ to the next edge---in the counterclockwise direction---on the hull of the right triangulation. Similar to our process with $ldi$, we make the corresponding note that $rdi.rnext$ is the next edge with the same right face as $rdi$, and is the next hull edge on $D_{R}$.\par

    We loop in this fashion, advancing $ldi$ and $rdi$ in the appropriate manner until both \textsc{CCW} tests fail. Note that when both tests fail, the line determined by the endpoints of $ldi$ will not intersect with $D_{R}$ and the corresponding line for $rdi$ will not intersect with $D_{L}$. So we know that the line whose endpoints are $rdi.org$ and $ldi.org$ is tangent to both triangulations. We create this edge, $basel$, and return it in line \ref{lct_fin}\par

    Stepping back into \nameref{del_merge}, we can now begin the journey upward: we're at the \say{rising bubble} stage, lines \ref{rb} through \ref{rb_end}. \Cref{fig:del_knit_all} on page \pageref{fig:del_knit_all} illustrates this process. The idea behind this loop is to begin with $\ell$ and $r$, which are edges on hulls of their respective triangulations. At the first iteration of the loop, we set $\ell$ to the next outgoing edge whose source is $basel.twin.org$, meaning that $\ell$ is the edge on the convex hull of $D_{L}$ who shares its source vertex with the quad-edge representing the lower common tangent. We do a an analogous thing with $r$. As we iterate through the loop, $\ell$ and $r$ are always set to the convex hull edge whose respective sources are shared with the \say{uppermost} known cross-edge that the time, $basel$. We need to determine whether or not these edges will remain in the final diagram, and subsequently, the appropriate edge which will span $D_{L}$ and $D_{R}$. In line \ref{valid_l} we check to see whether or not $\ell$ is valid with \textsc{Valid}. Recall that \textsc{Valid} is a helper function that tells us whether or not an edge is above $basel$. 

    If $\ell$ is a valid edge, we enter a loop in line \ref{rm_l} which we assess whether or not $\ell$ can remain in the merged diagram. This is accomplished with an \textsc{InCircle} test. Recall that $onext$ points to the next edge (in counterclockwise direction) whose source is $ldi.org$. If $ldi.onext.dest$ is contained in the circle defined by the endpoints of $basel$ and the destination of $\ell$, then we know that creating a face with these vertices would result in a face which is not locally Delaunay. So we remove the offending edge, and update $\ell$ to point to the next edge with the same source.\par

    When we exit this loop, we know that $\ell$ will be in the merged result. We wish to do the same for $r$; this is accomplished in the loop beginning at line \ref{rm_r}. The only change is that if we fail the \textsc{InCircle} test, we remove the edge $r$ and update $r$ to $r.oprev$, where $oprev$ is the next edge in the clockwise direction with the same source as $r$.\par

    Finally, we have reached line \ref{ce}, where we can say that we have a grasp on two edges, $\ell$ and $r$, which will be in the merged result. Note that since we might have deleted some edges, $\ell$ and $r$ might not be edges on the convex hull of their respective triangulations. We know that one of the endpoints of new spanning edge will be either $basel.org$ or $basel.dest$. We also know that the other endpoint of the new edge will be either $r.dest$ or $\ell.dest$. There are two possible triangles: $basel.source$, $basel.dest$, $\ell.dest$; and $basel.source$, $basel.dest$, $r.dest$. The if statements following line \ref{ce} determine and create the appropriate cross edge. Precisely, if $\ell$ and $r$ are not valid, then neither of them are above $basel$, so we must be at the upper common tangent, and thus have no need to create a cross edge. In \ref{ce_1} we check to see if one or both of the following is true: $\ell$ is not valid\footnote{Meaning that $\ell$'s destination is an endpoint of $basel$, so we can't create a triangle with $basel.source$, $basel.dest$, $\ell.dest$.}; or $r$ is valid, and the triangle formed by $\ell.dest$, $\ell.org$ and $r.dest$ contains a site (namely, $r.oprev.dest$). Since this triangle would not be locally delaunay, we create the triangle $r.dest$, $basel.dest$, $basel.org$ by adding an edge with \textsc{Connect} in line \ref{ce_add1}. We update $basel$ to be this edge, which is the \say{uppermost} edge spanning $D_{L}$ and $D_{R}$. If neither of these cases holds, then we know $basel.source$, $basel.dest$, $\ell.dest$ to be a triangle which is locally Delaunay, and we return the edge reflecting that in line \ref{ce_add2}. 

    \begin{algorithm}[H]
    \caption{\textsc{DelLCT}}\label{del_lct}
     \begin{algorithmic}[1]
    \Procedure{DelLCT}{$ldi$, $rdi$}
    \Loop
      \If{\Call{CCW}{$rdi.org$, $ldi.org$, $ldi.dest$}} \label{left_of}
        \State $ldi\gets ldi.lnext$ \label{inc_ldi}
      \ElsIf{\Call{CCW}{$ldi.org$, $rdi.dest$, $rdi.org$}} \label{right_of}
        \State $rdi\gets rdi.rnext$
      \Else
        \State $basel\gets$\Call{Connect}{rdi.sym, ldi}
        \State \textbf{return} $basel$ \label{lct_fin}
      \EndIf
    \EndLoop
    \EndProcedure
    \end{algorithmic} 
    \end{algorithm}
  
  % subsection divide_and_conquer_algorithm_pseudocode (end)

  \section{Some Final Thoughts} % (fold)
  \label{sec:some_final_thoughts}

  % section some_final_thoughts (end)

\appendix
  \chapter{(The Post Office Problem Re-framed)}
  \label{appendix_one}
  Here you are, in a forest; you are studying trees. You are lying in the undergrowth and the shade is covering your face. It smells like pine needles and your fingers are sticky with sap. There is another tree about a dozen feet away. We all know exactly how far away it is, but dozen sounds more prosaic. so it's a dozen feet away, and why is that? [area availiable to a tree]\par
  You're walking the blocks of new york city and the wind is cold. Where is the nearest subway entrance? People are walking past you though, really, you're just shuffling. Where is the nearest subway with an N train? Is it a local or express line? Are you hungry, maybe you're hungry. Or maybe you're the one selling hot dogs. yes. hot dogs in new york city. where should you put your hot dog cart?] 
\backmatter
\bibliographystyle{APA/apa-good}  % or
% \bibliographystyle{mla-good}
\bibliography{ifj_thesis}
% Finally, an index would go here... but it is also optional.
\end{document}
